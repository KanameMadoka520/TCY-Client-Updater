<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">

    <!--
    PROJECT: TCY Client Updater
    AUTHOR: KanameMadoka520
    LICENSE: CC BY-NC-SA 4.0 (Creative Commons Attribution-NonCommercial-ShareAlike 4.0)

    æ­¤é¡¹ç›®éµå¾ª CC BY-NC-SA 4.0 åè®®ã€‚
    1. å…è®¸éå•†ä¸šç”¨é€”çš„å¤åˆ¶ã€ä¿®æ”¹å’Œåˆ†å‘ã€‚
    2. ç¦æ­¢ä»»ä½•å½¢å¼çš„å•†ä¸šç›ˆåˆ©è¡Œä¸ºï¼ˆåŒ…æ‹¬ä½†ä¸é™äºä»˜è´¹æ•´åˆåŒ…ã€ä»˜è´¹æœä¸“ç”¨å®¢æˆ·ç«¯ï¼‰ã€‚
    3. ä¿®æ”¹åçš„ç‰ˆæœ¬å¿…é¡»ä»¥ç›¸åŒåè®®ï¼ˆå¼€æºï¼‰å‘å¸ƒï¼Œå¹¶ä¿ç•™åŸä½œè€…ç½²åã€‚

    è¯¦æƒ…è¯·å‚é˜…: https://creativecommons.org/licenses/by-nc-sa/4.0/
-->

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCY Client Updater</title>
    <style>
        /* =========================================
        1. å…¨å±€å˜é‡ä¸é«˜çº§åŠ¨ç”»æ›²çº¿
        ========================================= */
        :root {
            /* Apple é£æ ¼çš„éçº¿æ€§åŠ¨ç”»æ›²çº¿ï¼Œæ¯”é»˜è®¤ ease æ›´ä¼˜é›… */
            --ease-spring: cubic-bezier(0.4, 0.0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

            /* åŸºç¡€å¤–è§‚å˜é‡ */
            --bg-image: none;
            --bg-blur: 0px;
            --bg-size: cover;
            --mask-opacity: 0.4;
            /* é»˜è®¤å€¼ä¸º 0 (å³å¡ç‰‡é»˜è®¤ä¸æ¨¡ç³Š) */
            --card-blur: 0px;

            /* ä¾§è¾¹æ å’Œå¡ç‰‡èƒŒæ™¯ (é…åˆ backdrop-filter ä½¿ç”¨) */
            --sidebar-bg: rgba(255, 255, 255, 0.65);
            --card-bg: rgba(255, 255, 255, 0.65);

            --font-family: 'Segoe UI', system-ui, sans-serif;
            --text-color: #333333;
            --accent-color: #f59e0b;

            --text-shadow: none;
            --border-color: rgba(0, 0, 0, 0.08);
            --card-border: 1px solid rgba(255, 255, 255, 0.2);
            /* äº®è¾¹ */

            --titlebar-height: 32px;
        }

        /* =========================================
        2. åŸºç¡€å¸ƒå±€
        ========================================= */
        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-family);
            height: 100vh;
            display: flex;
            overflow: hidden;
            user-select: none;
            background: transparent;
            color: var(--text-color);
            text-shadow: var(--text-shadow);
            transition: text-shadow 0.3s, color 0.3s;
            border-radius: 12px;
            /* è¾¹æ¡†ç¨å¾®è°ƒäº®ä¸€ç‚¹ï¼Œå¢åŠ ç²¾è‡´æ„Ÿ */
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-sizing: border-box;
            clip-path: inset(0 round 12px);
        }

        #app-background {
            position: fixed;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            background-image: var(--bg-image);
            background-size: var(--bg-size);
            background-repeat: no-repeat;
            background-position: center;
            z-index: -2;
            filter: blur(var(--bg-blur));
            transition: filter 0.2s, background-size 0.3s;
        }

        #app-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, var(--mask-opacity));
            z-index: -1;
            transition: background-color 0.2s;
        }

        /* =========================================
        3. æ ‡é¢˜æ ä¸çª—å£æ§åˆ¶
        ========================================= */
        #custom-titlebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--titlebar-height);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            z-index: 9999;
            background: transparent;
        }

        .drag-region {
            position: absolute;
            top: 0;
            left: 0;
            right: 100px;
            height: 100%;
            cursor: default;
        }

        .window-controls {
            display: flex;
            height: 100%;
            z-index: 10000;
        }

        .win-btn {
            width: 40px;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
            color: var(--text-color);
            opacity: 0.7;
        }

        .win-btn:hover {
            background: rgba(128, 128, 128, 0.2);
            opacity: 1;
        }

        .win-btn.close:hover {
            background: #e81123;
            color: white;
        }

        .win-btn svg {
            width: 12px;
            height: 12px;
            fill: none;
            stroke: currentColor;
            stroke-width: 1.5;
        }

        /* =========================================
        4. ä¾§è¾¹æ  (Sidebar)
        ========================================= */
        .sidebar {
            width: 220px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 0 16px 24px 16px;
            padding-top: var(--titlebar-height);

            /* æ¯›ç»ç’ƒå¢å¼º */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);

            transition: background 0.2s, backdrop-filter 0.2s, border-right 0.2s;
        }

        .brand {
            font-size: 16px;
            font-weight: 800;
            color: var(--accent-color);
            margin: 10px 0 24px 0;
            padding-left: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 0.5px;
            text-shadow: none;
            pointer-events: none;
        }

        .icon {
            width: 18px;
            height: 18px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .nav-item {
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 12px;
            /* ä½¿ç”¨å¹³æ»‘è¿‡æ¸¡ */
            transition: all 0.3s var(--ease-spring);
            position: relative;
            overflow: hidden;
        }

        body.transparent-mode .nav-item {
            opacity: 1;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.5);
            opacity: 1;
            transform: scale(1.02);
            /* æ‚¬åœå¾®åŠ¨ */
        }

        .nav-item:active {
            transform: scale(0.96);
            /* ç‚¹å‡»å›å¼¹ */
        }

        .nav-item.active {
            background: var(--accent-color);
            color: white;
            opacity: 1;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-shadow: none;
        }

        .nav-item.active .icon {
            stroke: white;
        }

        /* =========================================
        5. ä¸»å†…å®¹åŒºåŸŸ (Main)
        ========================================= */
        .main {
            flex: 1;
            padding: 20px 40px;
            padding-top: calc(var(--titlebar-height) + 20px);
            overflow-y: overlay;
            position: relative;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .main::-webkit-scrollbar-track {
            background: transparent;
        }

        .main::-webkit-scrollbar {
            width: 8px;
            background: transparent;
        }

        .main::-webkit-scrollbar-thumb {
            background-color: transparent;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .main:hover::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
        }

        body.transparent-mode .main:hover::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .main.is-scrolling::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.3) !important;
        }

        body.transparent-mode .main.is-scrolling::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.4) !important;
        }

        .page {
            display: none;
            /* é¡µé¢åˆ‡æ¢åŠ¨ç”» */
            animation: fadeIn 0.3s var(--ease-spring);
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 20px 0;
            color: var(--text-color);
        }

        h3 {
            color: var(--text-color);
        }

        /* =========================================
        6. å¡ç‰‡ (Card) - æ ¸å¿ƒç¾åŒ–åŒºåŸŸ
        ========================================= */
        /* 1. å®šä¹‰æµå…‰åŠ¨ç”»çš„å…³é”®å¸§ (æ”¾åœ¨ .card ä¹‹å‰) */
        @keyframes border-dance {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. ä¸»å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--card-bg);

            /* ã€ä¿®æ”¹ã€‘ä¸å†å†™æ­» 12pxï¼Œè€Œæ˜¯ä½¿ç”¨å˜é‡ (ä¿ç•™åŸæœ‰é€»è¾‘) */
            backdrop-filter: blur(var(--card-blur));
            -webkit-backdrop-filter: blur(var(--card-blur));

            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;

            /* é«˜çº§è´¨æ„Ÿè¾¹æ¡† (åŠé€æ˜ç™½çº¿) */
            border: 1px solid rgba(255, 255, 255, 0.25);

            /* åˆå§‹çŠ¶æ€é˜´å½± */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);

            /* å…³é”®ï¼šä½¿ç”¨è´å¡å°”æ›²çº¿å®ç°é¡ºæ»‘çš„æ‚¬æµ®è¿‡æ¸¡ */
            transition: transform 0.4s var(--ease-spring),
                box-shadow 0.4s var(--ease-spring),
                border-color 0.3s ease,
                backdrop-filter 0.1s; /* æ¨¡ç³Šçš„è¿‡æ¸¡åŠ¨ç”» */
            
            /* æ€§èƒ½ä¼˜åŒ– */
            will-change: transform, box-shadow;

            /* === å…³é”®å¸ƒå±€å±æ€§ === */
            /* è®¾ç½®ä¸º relative ä»¥ä¾¿å®šä½ä¼ªå…ƒç´ è¾¹æ¡† */
            position: relative;
            /* é˜²æ­¢æµå…‰æº¢å‡ºåœ†è§’ */
            overflow: hidden; 
            /* å»ºç«‹å±‚å ä¸Šä¸‹æ–‡ï¼Œä¿è¯ä¼ªå…ƒç´ åœ¨æ­£ç¡®å±‚çº§ */
            z-index: 1; 
        }

        /* === ä¼ªå…ƒç´ åŠ¨æ€æµå…‰å±‚ === */
        .card::before {
            content: "";
            position: absolute;
            inset: 0;
            padding: 2px; /* æµå…‰è¾¹æ¡†å®½åº¦ */
            border-radius: 16px; /* éœ€ä¸çˆ¶å…ƒç´ ä¸€è‡´ */
            
            /* ä½¿ç”¨ä¸»é¢˜è‰²è¿›è¡Œæ¸å˜ï¼Œæ¨¡æ‹Ÿ RGB å‘¼å¸ç¯ */
            /* è¿™é‡Œçš„ 40%-60% æ§åˆ¶å…‰æŸçš„ç²—ç»† */
            background: linear-gradient(
                45deg, 
                transparent 40%, 
                var(--accent-color) 50%, 
                transparent 60%
            );
            background-size: 200% 200%; /* æ”¾å¤§èƒŒæ™¯ä»¥æ”¯æŒç§»åŠ¨åŠ¨ç”» */
            
            /* é»˜è®¤éšè—ï¼Œæ‚¬åœæ—¶æ˜¾ç¤º */
            opacity: 0;
            transition: opacity 0.3s ease;
            
            /* åˆ©ç”¨é®ç½©è£åˆ‡å‡ºè¾¹æ¡†å½¢çŠ¶ (ä¸­é—´é•‚ç©º) */
            /* è¿™æ ·èƒŒæ™¯åªä¼šæ˜¾ç¤ºåœ¨ padding å®šä¹‰çš„è¾¹ç¼˜åŒºåŸŸ */
            -webkit-mask: 
            linear-gradient(#fff 0 0) content-box, 
            linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            
            pointer-events: none; /* è®©é¼ æ ‡ç©¿é€ï¼Œä¸å½±å“ç‚¹å‡»å¡ç‰‡å†…å®¹ */
            z-index: -1; /* æ”¾åœ¨å†…å®¹ä¹‹ä¸‹ï¼Œä½†åœ¨èƒŒæ™¯ä¹‹ä¸Š(å›  mask é•‚ç©º) */
        }

        /* é¼ æ ‡æ‚¬åœæ—¶çš„â€œç‰©ç†ä¸Šæµ®â€æ•ˆæœ (ä¿ç•™åŸæœ‰) */
        .card:hover {
            transform: translateY(-4px);
            /* æµ®èµ· */
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
            /* æŠ•å½±åŠ æ·± */
            border-color: rgba(255, 255, 255, 0.5);
            /* è¾¹æ¡†å˜äº® */
        }

        /* === æ‚¬åœæ—¶è§¦å‘æµå…‰ === */
        .card:hover::before {
            opacity: 1; /* æ˜¾ç¤ºæµå…‰ */
            animation: border-dance 2s linear infinite; /* å¼€å§‹å¾ªç¯æµåŠ¨ */
        }

        /* =========================================
        7. æŒ‰é’® (Button)
        ========================================= */
        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            background: var(--accent-color);
            color: white;
            /* å¹³æ»‘è¿‡æ¸¡ */
            transition: all 0.3s var(--ease-spring);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-shadow: none;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: scale(0.95);
            /* æœå†»ç‚¹å‡»æ„Ÿ */
            box-shadow: none;
        }

        .btn.outline {
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid #ddd;
            color: var(--text-color);
        }

        body.transparent-mode .btn.outline {
            background: rgba(255, 255, 255, 0.6);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .btn.small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn.danger {
            background: #ef4444;
        }

        .btn.danger-outline {
            background: transparent;
            border: 1px solid #ef4444;
            color: #ef4444;
        }

        .btn.danger-outline:hover {
            background: #fee2e2;
        }

        /* =========================================
        8. è¡¨å•æ§ä»¶ä¸æ—¥å¿—
        ========================================= */
        select,
        input[type="text"] {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            width: 100%;
            outline: none;
            font-family: inherit;
            color: #333;
            box-sizing: border-box;
            transition: border 0.2s, box-shadow 0.2s;
        }

        select:focus,
        input[type="text"]:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
            /* èšç„¦å…‰ç¯ */
        }

        input[type="range"] {
            flex: 1;
            accent-color: var(--accent-color);
            height: 4px;
            border-radius: 2px;
        }

        .log-box {
            background: #111827;
            color: #10b981;
            padding: 16px;
            border-radius: 12px;
            height: 180px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-shadow: none;
        }

        .log-box::-webkit-scrollbar-track {
            background: transparent;
        }

        .log-box::-webkit-scrollbar {
            width: 6px;
            background: transparent;
        }

        .log-box::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .log-box:hover::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
        }

        .log-item {
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            /* æ—¥å¿—æ»‘å…¥åŠ¨ç”» */
            animation: slideInLog 0.3s ease-out forwards;
            opacity: 0;
            transform: translateX(-10px);
        }

        .log-item:last-child {
            border-bottom: none;
        }

        @keyframes slideInLog {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* =========================================
        9. è¿›åº¦æ¡å¢å¼º (æµå…‰æ•ˆæœ)
        ========================================= */
        #dl-bar {
            position: relative;
            overflow: hidden;
            /* æ–œçº¹æµå…‰èƒŒæ™¯ */
            background-image: linear-gradient(45deg,
                    rgba(255, 255, 255, 0.15) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.15) 50%,
                    rgba(255, 255, 255, 0.15) 75%,
                    transparent 75%,
                    transparent);
            background-size: 20px 20px;
            animation: stripe-flow 1s linear infinite;
        }

        @keyframes stripe-flow {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 20px 20px;
            }
        }

        /* =========================================
        10. å¼¹çª—æ¨¡æ€æ¡† (Modal) åŠ¨ç”»
        ========================================= */
        #update-modal {
            transition: opacity 0.3s var(--ease-spring), backdrop-filter 0.3s;
        }

        /* å½“æ¨¡æ€æ¡†é‡Œçš„å¡ç‰‡å‡ºç°æ—¶ï¼Œä»ä¸‹å¾€ä¸Šå¼¹èµ· */
        #update-modal .card {
            animation: modal-pop 0.4s var(--ease-bounce) forwards;
        }

        @keyframes modal-pop {
            0% {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* =========================================
        11. å…¶ä»–ç»„ä»¶ (File Items, Alerts, Badges)
        ========================================= */
        .file-item {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .folder-header {
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 6px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .folder-header:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .folder-content {
            padding-left: 24px;
            display: none;
            margin-top: 4px;
        }

        .folder-item.open>.folder-content {
            display: block;
        }

        /* è­¦å‘Šæ¡†ç»Ÿä¸€æ ·å¼ */
        .alert-error,
        .alert-info,
        .alert-warning {
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            text-shadow: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .alert-error {
            padding: 12px 16px;
            background: #fee2e2;
            color: #991b1b;
        }

        .alert-info {
            padding: 12px 16px;
            background: #e0f2fe;
            color: #075985;
        }

        .alert-warning {
            padding: 10px 14px;
            background: #ffedd5;
            color: #9a3412;
            border-left: 4px solid #f97316;
        }

        .web-link-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .web-link-group:last-child {
            border-bottom: none;
        }

        .web-title {
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .web-actions {
            display: flex;
            gap: 8px;
        }

        .color-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s var(--ease-spring), border-color 0.2s;
        }

        .color-dot:hover {
            transform: scale(1.2);
        }

        .color-dot.active {
            border-color: #333;
            transform: scale(1.1);
        }

        body.transparent-mode .color-dot.active {
            border-color: white;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
            opacity: 0.8;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ver-title {
            font-weight: bold;
            color: var(--accent-color);
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .ver-title small {
            font-weight: normal;
            opacity: 0.6;
            font-size: 11px;
            color: var(--text-color);
        }

        .ver-desc {
            font-size: 13px;
            opacity: 0.8;
            margin-top: 4px;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        /* æ›´æ–°åˆ—è¡¨æ ·å¼ */
        .update-list-container {
            max-height: 250px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.03);
            /* å¾®è°ƒï¼šæ›´æ·¡çš„èƒŒæ™¯ */
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            /* å†…é˜´å½±å¢åŠ å±‚æ¬¡ */
        }

        .update-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, background 0.2s;
        }

        .update-item:hover {
            transform: translateX(2px);
            background: rgba(255, 255, 255, 0.8);
        }

        .update-item.mandatory {
            border-left: 4px solid #ef4444;
        }

        .update-item.optional {
            border-left: 4px solid #10b981;
        }

        .update-checkbox {
            margin-top: 4px;
            width: 18px;
            height: 18px;
            accent-color: var(--accent-color);
        }

        .update-content {
            flex: 1;
        }

        .update-header {
            font-weight: bold;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
        }

        .update-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            margin-left: 8px;
        }

        .badge-req {
            background: #ef4444;
        }

        .badge-opt {
            background: #10b981;
        }

        .update-body {
            font-size: 12px;
            margin-top: 4px;
            opacity: 0.8;
            white-space: pre-wrap;
        }
        /* =========================================
        æ•…éšœé£æ–‡å­— (Glitch Text)
        åº”ç”¨ä½ç½®ï¼šä¾§è¾¹æ æ ‡é¢˜å†…çš„ span (.glitch-text)
        ========================================= */

        /* 1. å®šä¹‰æŠ–åŠ¨åŠ¨ç”» */
        @keyframes glitch-skew {
            0% { transform: skew(0deg); }
            20% { transform: skew(-2deg); }
            40% { transform: skew(2deg); }
            60% { transform: skew(-1deg); }
            80% { transform: skew(1deg); }
            100% { transform: skew(0deg); }
        }

        /* 2. å®šä¹‰è£åˆ‡é—ªçƒåŠ¨ç”» */
        @keyframes glitch-anim {
            0% { clip-path: inset(80% 0 0 0); transform: translate(-2px, 1px); }
            20% { clip-path: inset(10% 0 60% 0); transform: translate(2px, -1px); }
            40% { clip-path: inset(50% 0 30% 0); transform: translate(-2px, 2px); }
            60% { clip-path: inset(30% 0 20% 0); transform: translate(2px, -2px); }
            80% { clip-path: inset(15% 0 80% 0); transform: translate(-1px, 1px); }
            100% { clip-path: inset(60% 0 10% 0); transform: translate(1px, -1px); }
        }

        /* 3. è®¾ç½®çˆ¶çº§ .brand æ ·å¼ (ç¡®ä¿å¸ƒå±€æ­£å¸¸) */
        .brand {
            font-size: 16px;
            font-weight: 800;
            color: var(--accent-color);
            margin: 10px 0 24px 0;
            padding-left: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 0.5px;
            text-shadow: none;
            /* ç§»é™¤ pointer-events: noneï¼Œå¦åˆ™é¼ æ ‡æ”¾ä¸Šå»æ²¡ååº”ï¼ */
            pointer-events: auto; 
            cursor: default;
        }

        /* 4. æ–‡å­—åŒ…è£¹å±‚æ ·å¼ */
        .glitch-text {
            position: relative;
            display: inline-block;
            color: var(--accent-color); /* é»˜è®¤æ˜¾ç¤ºå¼ºè°ƒè‰² */
            transition: color 0.3s;
        }

        /* 5. é¼ æ ‡æ‚¬åœåœ¨ brand ä¸Šæ—¶ï¼Œè§¦å‘ glitch-text çš„åŠ¨ç”» */
        .brand:hover .glitch-text {
            animation: glitch-skew 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite;
            color: var(--text-color); /* æ•…éšœæ—¶æ–‡å­—å˜é»‘/ç™½ï¼Œå¢å¼ºå¯¹æ¯” */
        }

        /* 6. ç”Ÿæˆæ•…éšœåˆ†èº« (å¹½çµå›¾å±‚) */
        .brand:hover .glitch-text::before,
        .brand:hover .glitch-text::after {
            content: attr(data-text); /* è¯»å– HTML é‡Œçš„ data-text */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--sidebar-bg); /* èƒŒæ™¯é®æŒ¡ï¼Œåˆ¶é€ åˆ‡å‰²æ„Ÿ */
            opacity: 0.8;
        }

        /* çº¢è‰²åˆ†èº« */
        .brand:hover .glitch-text::before {
            left: 2px;
            color: #ff00c1;
            text-shadow: -1px 0 #ff00c1;
            animation: glitch-anim 0.4s infinite linear alternate-reverse;
            z-index: -1;
        }

        /* é’è‰²åˆ†èº« */
        .brand:hover .glitch-text::after {
            left: -2px;
            color: #00fff9;
            text-shadow: -1px 0 #00fff9;
            animation: glitch-anim 0.4s infinite linear alternate-reverse;
            animation-delay: -0.2s;
            z-index: -2;
        }
    </style>
</head>

<body>
    <canvas id="particle-canvas"
        style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; pointer-events:none;"></canvas>
    
    <div id="app-background"></div>
    <div id="app-mask"></div>

    <div id="custom-titlebar">
        <div class="drag-region pywebview-drag-region"></div>
        <div class="window-controls">
            <div class="win-btn" onclick="windowControls('min')" title="æœ€å°åŒ–">
                <svg viewBox="0 0 12 12">
                    <path d="M1 6h10" stroke-linecap="round" />
                </svg>
            </div>
            <div class="win-btn" onclick="windowControls('max')" title="æœ€å¤§åŒ–/è¿˜åŸ">
                <svg viewBox="0 0 12 12">
                    <rect x="1.5" y="1.5" width="9" height="9" rx="1" />
                </svg>
            </div>
            <div class="win-btn close" onclick="windowControls('close')" title="å…³é—­">
                <svg viewBox="0 0 12 12">
                    <path d="M2 2l8 8M10 2l-8 8" stroke-linecap="round" />
                </svg>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="brand">
            <svg class="icon" style="width:24px; height:24px;" viewBox="0 0 24 24">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
            </svg>
            <span class="glitch-text" data-text="TCY Client Updater">TCY Client Updater</span>
        </div>

        <div id="nav-update" class="nav-item active" onclick="switchTab('update')">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            ç‰ˆæœ¬æ›´æ–°
        </div>
        <div id="nav-mods" class="nav-item" onclick="switchTab('mods')">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
            Mods ç®¡ç†
        </div>
        <div id="nav-config" class="nav-item" onclick="switchTab('config')">
            <svg class="icon" viewBox="0 0 24 24">
                <line x1="4" y1="21" x2="4" y2="14"></line>
                <line x1="4" y1="10" x2="4" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12" y2="3"></line>
                <line x1="20" y1="21" x2="20" y2="16"></line>
                <line x1="20" y1="12" x2="20" y2="3"></line>
                <line x1="1" y1="14" x2="7" y2="14"></line>
                <line x1="9" y1="8" x2="15" y2="8"></line>
                <line x1="17" y1="16" x2="23" y2="16"></line>
            </svg>
            Config ç®¡ç†
        </div>
        <div id="nav-shortcuts" class="nav-item" onclick="switchTab('shortcuts')">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
            å¿«æ·æ‰“å¼€
        </div>
        <div id="nav-settings" class="nav-item" onclick="switchTab('settings')">
            <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"></circle>
                <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                </path>
            </svg>
            ä¸ªæ€§åŒ–
        </div>
        <div style="flex:1"></div>
        <div id="nav-web" class="nav-item" onclick="switchTab('web')">
            <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                </path>
            </svg>
            ç¥äººæœåŠ¡å™¨å®˜æ–¹ç½‘ç«™
        </div>
    </div>

    <div class="main">
        <div id="page-update" class="page active">
            <h1>å®¢æˆ·ç«¯æ›´æ–°</h1>

            <div class="alert-info">
                <svg class="icon" style="width:20px; height:20px" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                æç¤ºï¼šè¯·æŠŠæœ¬å‡çº§å™¨æ”¾åœ¨ .minecraft åŒçº§ç›®å½•,
                æœ‰é—®é¢˜è¯·å¸¦ç€launcher_debug.logåœ¨github issueæˆ–åœ¨QQç¾¤åé¦ˆ.æ”¯æŒåŠŸèƒ½è®¸æ„¿!
            </div>
            <div class="alert-info">
                <svg class="icon" style="width:20px; height:20px" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                    ä¸å¯åˆ é™¤åŒç›®å½•ä¸‹launcher_settings.jsonæ–‡ä»¶,å¦åˆ™ä¹‹å‰çš„è®¾ç½®å’Œç‰ˆæœ¬è¯†åˆ«è®°å½•ä¸¢å¤±ã€‚
            </div>


            <div id="path-warning" class="alert-error" style="display:none;">
                <svg class="icon" style="width:20px; height:20px" viewBox="0 0 24 24">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                    </path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                æœªæ£€æµ‹åˆ°â€œ<span id="target-version-name"></span>â€ç›®å½•ï¼Œè¯·æ£€æŸ¥å®‰è£…ä½ç½®ï¼
            </div>

            <div id="path-success" class="alert-info" style="display:none; background:#dcfce7; color:#166534;">
                <svg class="icon" style="width:20px; height:20px" viewBox="0 0 24 24">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                å·²è¯†åˆ«ç›®å½•ï¼š<span id="detected-path-text" style="font-family:monospace; font-size:12px;"></span>
            </div>
                
            <div class="alert-warning">
                æœ¬æ›´æ–°åŒ…çš„åŸºç¡€æ˜¯ä½ æ‹¥æœ‰"Minecraftç³–é†‹é±¼ç¥äººæœåŠ¡å™¨å®¢æˆ·ç«¯ 20260125
                å¼‚ç•Œç”Ÿæ´»å†’é™©"å®¢æˆ·ç«¯oræ—§å®¢æˆ·ç«¯å®‰è£…äº†"ã€æ–°ç©å®¶æ— è§†æœ¬æ–‡ä»¶ã€‘å…¨é‡modsæ–‡ä»¶å¤¹æ›¿æ¢ç”¨-æ—§å®¢æˆ·ç«¯å‡çº§.zip"---------åœ¨ç¡®ä¿ä½ çš„å®¢æˆ·ç«¯æ­£ç¡®å,å¦‚æœç›®å½•ä¸å¯¹è¯·ç«‹å³æ£€æŸ¥æˆ–åé¦ˆç»™ç³–é†‹é±¼,TCYç¥äººæœåŠ¡å™¨çš„å®¢æˆ·ç«¯åº”å½“çœ‹è§è‡³å°‘åŒ…å«".minecraft\versions\å¼‚ç•Œæˆ˜æ–—å¹»æƒ³
            </div>

            <div class="card">
                <h3 style="margin-top:0; font-size:16px; display:flex; justify-content:space-between; align-items:center;">
                    åœ¨çº¿æ›´æ–°
                    <button class="btn small" onclick="pywebview.api.check_online_update()">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M23 4v6h-6"></path>
                            <path d="M1 20v-6h6"></path>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        æ£€æŸ¥æ›´æ–°-ç‚¹å‡»åè¯·ç¨ç­‰ç»“æœ
                    </button>
                </h3>
                <div style="font-size:12px; opacity:0.8; margin-top:5px;">
                    å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼š<span id="current-ver-display"
                        style="font-weight:bold; color:var(--accent-color)">Loading...</span>
                    <span style="margin: 0 10px; opacity:0.3">|</span>
                    æ›´æ–°å™¨ç‰ˆæœ¬ï¼š<span id="launcher-ver-display" style="font-weight:bold;">Loading...</span>
                </div>
                <div style="font-size:11px; opacity:0.55; margin-top:6px; line-height:1.6;">
                    å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è½®è¯¢å®˜ç½‘åŠ GitHub å¤‡ç”¨åœ°å€ï¼ˆå«åŠ é€Ÿå‰ç¼€ï¼‰è·å–ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ‰€æœ‰åœ°å€å‡ä¼šæ£€æŸ¥å¹¶è¿”å›ç»“æœã€‚
                </div>

                <div style="margin-top:14px; padding-top:12px; border-top:1px solid var(--border-color);">
                    <div style="display:flex; align-items:flex-start; gap:12px;">
                        <button class="btn small danger-outline" style="flex-shrink:0;" onclick="pywebview.api.get_all_history()" title="å¼ºåˆ¶é‡æ–°åº”ç”¨æŸä¸€æ¬¡å†å²æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                            </svg>
                            å¼ºåˆ¶æ‹‰å–å†å²ç‰ˆæœ¬
                        </button>
                        <div style="font-size:11px; opacity:0.6; line-height:1.6;">
                            ç”¨äºä½ æ˜ç¡®çŸ¥é“æ“ä½œç›®çš„ã€æƒ³è¦å¼ºåˆ¶é‡æ–°åº”ç”¨æŸä¸€æ¬¡å†å²æ›´æ–°çš„æƒ…å†µã€‚<br>
                            æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ <code>launcher_settings.json</code> ä¸­çš„ç‰ˆæœ¬å·ï¼Œä»åˆ—è¡¨é€‰æ‹©ç›®æ ‡ç‰ˆæœ¬åç‚¹å‡»æ›´æ–°å³å¯ã€‚
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="border-left: 4px solid #64748b;">
                <h3 style="margin-top:0; font-size:16px; display:flex; align-items:center; gap:8px;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    æ‰‹åŠ¨ / ç¦»çº¿å®‰è£…æ›´æ–°åŒ…
                </h3>

                <div style="font-size:13px; opacity:0.8; margin-bottom:12px; line-height: 1.6;">
                    <div style="margin-bottom:4px;">é€‚ç”¨äºæ— æ³•è¿æ¥å®˜ç½‘tcymc.space,æ— æ³•è·å¾—å®˜ç½‘æä¾›çš„jsonç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶å†…å®¹ï¼Œæˆ–éœ€å¼ºåˆ¶å›é€€æ—§ç‰ˆæœ¬çš„ç‰¹æ®Šæƒ…å†µã€‚</div>
                    <ul style="margin: 0; padding-left: 18px; font-size: 12px; color:var(--text-color);">
                        <li><strong>è¯†åˆ«è§„åˆ™ï¼š</strong> è‡ªåŠ¨æ‰«æç›®å½•ä¸‹çš„ <code>update_*.zip</code> æ–‡ä»¶ã€‚</li>
                        <li><strong>âš ï¸ æ³¨æ„ï¼š</strong> æ­¤æ¨¡å¼å°†<span style="color:#ef4444; font-weight:bold;">å¿½ç•¥å¯é€‰æ›´æ–°è§„åˆ™</span>ï¼Œå¼ºåˆ¶æ‰§è¡ŒåŒ…å†…æ‰€æœ‰å˜æ›´ã€‚
                        </li>
                    </ul>
                </div>

                <select id="version-select" style="margin:5px 0 15px 0; font-family: 'Consolas', monospace;"></select>

                <div style="display:flex; gap:10px;">
                    <button class="btn" onclick="startUpdate()">
                        <svg class="icon" style="width:14px; height:14px" viewBox="0 0 24 24">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                            <polyline points="13 2 13 9 20 9"></polyline>
                        </svg>
                        å¼€å§‹å®‰è£…
                    </button>
                    <button class="btn outline" onclick="refreshVersions()">
                        <svg class="icon" style="width:14px; height:14px" viewBox="0 0 24 24">
                            <path d="M23 4v6h-6"></path>
                            <path d="M1 20v-6h6"></path>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        åˆ·æ–°åˆ—è¡¨
                    </button>
                </div>
            </div>
            <div class="card">
                <h3 style="margin-top:0; font-size:16px;">æ‰§è¡Œæ—¥å¿—</h3>
                <div class="log-box" id="log-container">
                    <div>[ç¥äººæ›´æ–°å™¨ç³»ç»Ÿ] ç­‰å¾…æ“ä½œä¸­...</div>
                </div>
            </div>
        </div>

        <div id="page-mods" class="page">
            <h1>mods ç®¡ç†</h1>
            <div class="card" style="margin-bottom: 14px; font-size: 13px; line-height: 1.4; color: #000000;">
                <details>
                    <summary style="cursor: pointer; outline: none; list-style: none;">
                        <h3 style="display: inline-block; margin-top: 0; margin-bottom: 0; font-size: 1.17em;">
                            â„¹ï¸ æ¨¡ç»„æ¥æºä¸æ¢å¤æŒ‡å— <span
                                style="font-size: 12px; font-weight: normal; opacity: 0.6; margin-left: 5px;">(ç‚¹å‡»å±•å¼€æŸ¥çœ‹)</span>
                        </h3>
                    </summary>
            
                    <div
                        style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); animation: fadeIn 0.3s ease;">
                        <div style="margin-bottom: 15px;">
                            <strong>1. æ¨¡ç»„æ¥æºè¯´æ˜ï¼š</strong><br>
                            <span style="color: #333333;">æœ¬å®¢æˆ·ç«¯æ¨¡ç»„åº”å½“åŒ…å«ä»¥ä¸‹æ¥æºï¼Œè¯·å‹¿éšæ„æ··å…¥æ¥æºä¸æ˜çš„æ–‡ä»¶ï¼š</span>
                            <ul style="margin: 5px 0; padding-left: 20px; color: #333333;">
                                <li>åŸºç¡€åŒ…è‡ªå¸¦ï¼š<span style="color: #0056b3; font-weight: bold;">Minecraftç³–é†‹é±¼ç¥äººæœåŠ¡å™¨å®¢æˆ·ç«¯ 20260125
                                        å¼‚ç•Œç”Ÿæ´»å†’é™©.zip</span></li>
                                <li>æˆ–æ›¿æ¢åŒ…ï¼š<span style="color: #0056b3; font-weight: bold;">ã€æ–°ç©å®¶æ— è§†æœ¬æ–‡ä»¶ã€‘å…¨é‡modsæ–‡ä»¶å¤¹æ›¿æ¢ç”¨-æ—§å®¢æˆ·ç«¯å‡çº§.zip</span>
                                </li>
                                <li>ä»¥åŠï¼š<strong>æœ¬æ›´æ–°å™¨åç»­è‡ªåŠ¨ä¸‹è½½çš„æ›´æ–°æ–‡ä»¶ã€‚</strong></li>
                            </ul>
                        </div>
            
                        <div>
                            <strong style="color: #d32f2f;">2. è¯¯åˆ æ¢å¤ / åæ¡£ä¿®å¤ (é‡è¦)ï¼š</strong><br>
                            <span style="color: #333333;">å¦‚æœæ‚¨ä¸å°å¿ƒè¯¯åˆ äº†æ¨¡ç»„ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</span>
                            <ol style="margin-top: 8px; padding-left: 20px; color: #333333;">
                                <li>å‰å¾€ <b>ã€ç¥äººæœåŠ¡å™¨å®˜æ–¹ç½‘ç«™ã€‘</b> - <b>ã€æœåŠ¡å™¨æ–‡ä»¶ä¸‹è½½ã€‘</b> é¡µé¢ã€‚</li>
                                <li>ä¸‹è½½ <span style="color: #0056b3; font-weight: bold;">ã€æ–°ç©å®¶æ— è§†æœ¬æ–‡ä»¶ã€‘å…¨é‡modsæ–‡ä»¶å¤¹æ›¿æ¢ç”¨-æ—§å®¢æˆ·ç«¯å‡çº§.zip</span>ã€‚
                                </li>
                                <li>è§£å‹å¹¶å°†é‡Œé¢çš„æ–‡ä»¶ <strong>å…¨é‡è¦†ç›–</strong> åˆ°æ‚¨å½“å‰çš„ <code>mods</code> æ–‡ä»¶å¤¹ä¸­ã€‚</li>
                                <li>
                                    ä¿®æ”¹æ›´æ–°å™¨åŒç›®å½•ä¸‹çš„ <span style="color: #e65100; font-weight: bold;">launcher_settings.json</span>
                                    æ–‡ä»¶ï¼š<br>
                                    æ‰¾åˆ° <code>"current_version"</code> æ ç›®ï¼Œå°†å…¶ä¿®æ”¹ä¸ºï¼š
                                    <div
                                        style="background: #f5f5f5; border: 1px solid #ccc; padding: 5px 10px; border-radius: 4px; margin: 5px 0; font-family: monospace; color: #2e7d32;">
                                        "current_version": "26.02.06.15.24"
                                    </div>
                                </li>
                                <li>ä¿å­˜æ–‡ä»¶å <strong>é‡å¯æœ¬æ›´æ–°å™¨</strong>ã€‚æ›´æ–°å™¨å°†é»˜è®¤æ‚¨å¤„äºåˆå§‹ç‰ˆæœ¬ï¼Œå¹¶é€æ­¥è·å–åç»­çš„æ‰€æœ‰æ›´æ–°æ¨¡ç»„ï¼Œæ‚¨åªéœ€ä¾æ¬¡ç‚¹å‡»æ›´æ–°å³å¯ã€‚</li>
                            </ol>
                        </div>
                    </div>
                </details>
            </div>
            <div style="margin-bottom:15px; display:flex; gap:10px;">
                <button class="btn outline" onclick="loadFiles('mods')">åˆ·æ–°åˆ—è¡¨</button>
                <button class="btn outline" onclick="pywebview.api.open_folder('mods')">æ‰“å¼€modsæ–‡ä»¶å¤¹</button>
                <input type="text" id="search-mods" placeholder="ğŸ” æœç´¢ mod (æ”¯æŒæ­£åˆ™,ä¹Ÿå¯æœåˆ°æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶)..."
                    style="flex:1; padding:8px; border-radius:8px; border:1px solid #ddd;" oninput="filterFiles('mods', this.value)">
            </div>

            <div class="card" id="mods-list">æ¨¡ç»„åˆ—è¡¨åŠ è½½ä¸­...å¦‚æœåˆ·æ–°ä¹Ÿæ— æ•ˆ,è¯·æ£€æŸ¥æ›´æ–°å™¨æ˜¯å¦æ”¾å¯¹åœ°æ–¹</div>
        </div>

        <div id="page-config" class="page">
            <h1>config ç®¡ç†</h1>
            <div class="alert-warning">
                åŒå‡»å¯æ‰“å¼€å¯¹åº”æ–‡ä»¶ï¼Œé™¤éä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™ä¸è¦ä¿®æ”¹ã€‚åœ¨å¤šäººæ¸¸æˆé‡Œä»…å¯¹å®¢æˆ·ç«¯modç”Ÿæ•ˆï¼Œåœ¨å•äººæ¸¸æˆé‡Œå…¨éƒ¨ç”Ÿæ•ˆã€‚
            </div>
            <div style="margin-bottom:15px; display:flex; gap:10px;">
                <button class="btn outline" onclick="loadFiles('config')">åˆ·æ–°åˆ—è¡¨</button>
                <button class="btn outline" onclick="pywebview.api.open_folder('config')">æ‰“å¼€configæ–‡ä»¶å¤¹</button>
                <input type="text" id="search-config" placeholder="ğŸ” æœç´¢ config (æ”¯æŒæ­£åˆ™,ä¹Ÿå¯æœåˆ°æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶)..."
                    style="flex:1; padding:8px; border-radius:8px; border:1px solid #ddd;" oninput="filterFiles('config', this.value)">
            </div>
            <div class="card" id="config-list">é…ç½®åˆ—è¡¨åŠ è½½ä¸­...å¦‚æœåˆ·æ–°ä¹Ÿæ— æ•ˆ,è¯·æ£€æŸ¥æ›´æ–°å™¨æ˜¯å¦æ”¾å¯¹åœ°æ–¹</div>
        </div>

        <div id="page-shortcuts" class="page">
            <h1>å¿«æ·æ‰“å¼€</h1>
            <div class="alert-info">
                æ­¤å¤„åªèƒ½æ‰“å¼€TCYç¥äººæœåŠ¡å™¨æ‰€ç”¨â€œå¼‚ç•Œæˆ˜æ–—å¹»æƒ³â€ç‰ˆæœ¬æ–‡ä»¶å¤¹å†…çš„å†…å®¹ã€‚åç»­ç­‰å¾…å¼€å‘å…¶ä»–åŠŸèƒ½
            </div>
            <div class="card">
                <div style="display:flex; flex-direction:column; gap:15px;">
                    <button class="btn outline" onclick="openShortcut('resourcepacks')"
                        style="justify-content:flex-start">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                            </path>
                        </svg>
                        æ‰“å¼€æè´¨åŒ…æ–‡ä»¶å¤¹ (resourcepacks)
                    </button>
                    <button class="btn outline" onclick="openShortcut('shaderpacks')"
                        style="justify-content:flex-start">
                        <svg class="icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        æ‰“å¼€å…‰å½±åŒ…æ–‡ä»¶å¤¹ (shaderpacks)
                    </button>
                    <button class="btn outline" onclick="openShortcut('screenshots')"
                        style="justify-content:flex-start">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                            </path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                        æ‰“å¼€æ¸¸æˆæˆªå›¾æ–‡ä»¶å¤¹ (screenshots)
                    </button>
                </div>
            </div>
        </div>

        <div id="page-web" class="page">
            <h1>ç¥äººæœåŠ¡å™¨å®˜æ–¹ç½‘ç«™</h1>
            <div class="card">
                <div class="web-link-group">
                    <div class="web-title">ğŸ“¢ æœ€æ–°æ›´æ–°æ—¥å¿—</div>
                    <div class="web-actions">
                        <button class="btn small outline" onclick="openUrl('https://cn.tcymc.space/update/latest/')">ğŸš€
                            CNåŠ é€Ÿ</button>
                        <button class="btn small outline" onclick="openUrl('https://tcymc.space/update/latest/')">ğŸŒ
                            å…¨çƒ</button>
                    </div>
                </div>
                <div class="web-link-group">
                    <div class="web-title">ğŸ“œ å†å²æ›´æ–°è®°å½•</div>
                    <div class="web-actions">
                        <button class="btn small outline" onclick="openUrl('https://cn.tcymc.space/update/history/')">ğŸš€
                            CNåŠ é€Ÿ</button>
                        <button class="btn small outline" onclick="openUrl('https://tcymc.space/update/history/')">ğŸŒ
                            å…¨çƒ</button>
                    </div>
                </div>
                <div class="web-link-group">
                    <div class="web-title">ğŸ  å®˜ç½‘é¦–é¡µ</div>
                    <div class="web-actions">
                        <button class="btn small outline" onclick="openUrl('https://cn.tcymc.space')">ğŸš€ CNåŠ é€Ÿ</button>
                        <button class="btn small outline" onclick="openUrl('https://tcymc.space')">ğŸŒ å…¨çƒ</button>
                    </div>
                </div>
                <div class="web-link-group">
                    <div class="web-title">ğŸ“¥ æœåŠ¡å™¨æ–‡ä»¶ä¸‹è½½</div>
                    <div class="web-actions">
                        <button class="btn small outline" onclick="openUrl('https://cn.tcymc.space/update/download/')">ğŸš€
                            CNåŠ é€Ÿ</button>
                        <button class="btn small outline" onclick="openUrl('https://tcymc.space/update/download/')">ğŸŒ
                            å…¨çƒ</button>
                    </div>
                </div>

                <div class="web-link-group">
                    <div class="web-title">â­ æœ¬è½¯ä»¶GitHubä»“åº“ (ç‚¹ç‚¹Star~)</div>
                    <div class="web-actions">
                        <button class="btn small outline"
                            onclick="openUrl('https://github.com/KanameMadoka520/TCY-Client-Updater')">ğŸ±
                            è®¿é—®ä»“åº“</button>
                    </div>
                </div>
                <div class="web-link-group">
                    <div class="web-title">ğŸ“‚ æœ¬æœæ›´æ–°æ–‡ä»¶å…¬ç¤ºä»“åº“</div>
                    <div class="web-actions">
                        <button class="btn small outline"
                            onclick="openUrl('https://github.com/KanameMadoka520/TCY-Server-Updates')">ğŸ±
                            è®¿é—®ä»“åº“</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-settings" class="page">
            <h1>ä¸ªæ€§åŒ–è®¾ç½®</h1>

            <div class="card">
                <h3 style="margin-top:0">ç½‘ç»œè®¾ç½®</h3>
                <div class="control-group">
                    <span class="control-label">GitHub é•œåƒåŠ é€Ÿå‰ç¼€ (CNé€šé“)</span>
                    <input type="text" id="mirror-prefix-input" placeholder="æœ¬è½¯ä»¶é»˜è®¤ä¸º: https://gh-proxy.org/ å¦‚æœæ•ˆæœä¸å¥½è¯·æ‰¾å…¶ä»–åŠ é€Ÿå‰ç¼€"
                        onchange="updateSettingsFromUI()">
                    <div style="font-size:12px; margin-top:5px; opacity:0.7">
                        ç”¨äºåŠ é€Ÿ GitHub æ–‡ä»¶ä¸‹è½½ã€‚æ¨èå‰ç¼€å¯è®¿é—®ï¼š<a href="#" onclick="openUrl('https://gh-proxy.com/')"
                            style="color:var(--accent-color)">gh-proxy.com</a>
                    </div>
                </div>
            </div>

            <!-- === è‡ªå®šä¹‰æ›´æ–°æºè®¾ç½® === -->
            <div class="card">
                <h3 style="margin-top:0; display:flex; justify-content:space-between; align-items:center;">
                    è‡ªå®šä¹‰æ›´æ–°æº
                    <button class="btn small outline" onclick="restoreDefaultUpdateUrls()">æ¢å¤é»˜è®¤æ›´æ–°æº</button>
                </h3>
                <div class="alert-info" style="margin-bottom:15px; font-size:12px;">
                    <svg class="icon" style="width:18px; height:18px; flex-shrink:0;" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    ç¨‹åºå¯åŠ¨æ—¶ä¼šå¯¹ä»¥ä¸‹æ‰€æœ‰åœ°å€é€ä¸€æ£€æŸ¥ï¼Œæ”¶é›†æ¯ä¸ªåœ°å€çš„è¿æ¥ç»“æœåç»Ÿä¸€å±•ç¤ºã€‚<br>
                    åªè¦æœ‰ä¸€ä¸ªåœ°å€èƒ½æ‹‰å–åˆ°ä¿¡æ¯å°±æ˜¯æ­£å¸¸çš„ï¼Œå¦åˆ™è”ç³»ç³–é†‹é±¼ã€‚
                </div>

                <div style="margin-bottom:14px;">
                    <div style="font-size:12px; font-weight:bold; margin-bottom:6px; opacity:0.8;">å®¢æˆ·ç«¯ç‰ˆæœ¬ JSON (latest.json) è½®è¯¢åœ°å€ï¼š</div>
                    <div id="latest-url-list" style="font-size:11px; font-family:'Consolas',monospace; background:rgba(0,0,0,0.04); border-radius:6px; padding:8px 10px; line-height:2;">
                        <div style="opacity:0.5;">ï¼ˆåŠ è½½ä¸­...ï¼‰</div>
                    </div>
                </div>
                <div style="margin-bottom:14px;">
                    <div style="font-size:12px; font-weight:bold; margin-bottom:6px; opacity:0.8;">æ›´æ–°å™¨ç‰ˆæœ¬ JSON (Updater-latest.json) è½®è¯¢åœ°å€ï¼š</div>
                    <div id="updater-url-list" style="font-size:11px; font-family:'Consolas',monospace; background:rgba(0,0,0,0.04); border-radius:6px; padding:8px 10px; line-height:2;">
                        <div style="opacity:0.5;">ï¼ˆåŠ è½½ä¸­...ï¼‰</div>
                    </div>
                </div>

                <div class="control-group">
                    <span class="control-label">è‡ªå®šä¹‰å®¢æˆ·ç«¯ç‰ˆæœ¬ JSON åœ°å€ (latest.json)</span>
                    <input type="text" id="custom-latest-url-input"
                        placeholder="é»˜è®¤: https://tcymc.space/update/latest.json"
                        onchange="updateSettingsFromUI(); refreshUrlLists()">
                    <div style="font-size:12px; margin-top:5px; opacity:0.7">
                        å¡«å†™åå°†ä½œä¸ºæœ€é«˜ä¼˜å…ˆçº§åœ°å€æ’å…¥è½®è¯¢åˆ—è¡¨é¦–ä½ã€‚ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤åœ°å€ã€‚
                    </div>
                </div>
                <div class="control-group">
                    <span class="control-label">è‡ªå®šä¹‰æ›´æ–°å™¨ç‰ˆæœ¬ JSON åœ°å€ (Updater-latest.json)</span>
                    <input type="text" id="custom-updater-url-input"
                        placeholder="é»˜è®¤: https://tcymc.space/update/Updater-latest.json"
                        onchange="updateSettingsFromUI(); refreshUrlLists()">
                    <div style="font-size:12px; margin-top:5px; opacity:0.7">
                        å¡«å†™åå°†ä½œä¸ºæœ€é«˜ä¼˜å…ˆçº§åœ°å€æ’å…¥è½®è¯¢åˆ—è¡¨é¦–ä½ã€‚ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤åœ°å€ã€‚
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-top:0">ä¸»é¢˜ä¸é…è‰²</h3>

                <div class="control-group">
                    <span class="control-label">å…¨å±€å­—ä½“</span>
                    <select id="font-select" onchange="updateSettingsFromUI()">
                        <option value="'Segoe UI', system-ui, sans-serif">Segoe UI (ç³»ç»Ÿé»˜è®¤)</option>
                        <option value="'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif">å¾®è½¯é›…é»‘ (Microsoft YaHei)</option>
                        <option value="'SimSun', 'å®‹ä½“', serif">å®‹ä½“ (SimSun)</option>
                        <option value="'Consolas', monospace">Consolas (ç­‰å®½)</option>
                        <option value="'Arial', sans-serif">Arial</option>
                    </select>
                </div>

                <div class="control-group">
                    <span class="control-label">ä¸»è‰²è°ƒ (Accent Color)</span>
                    <div style="display:flex; gap:10px; margin-top:5px">
                        <div class="color-dot" style="background:#f59e0b"
                            onclick="applyColorPreset('accent', '#f59e0b')"></div>
                        <div class="color-dot" style="background:#3b82f6"
                            onclick="applyColorPreset('accent', '#3b82f6')"></div>
                        <div class="color-dot" style="background:#10b981"
                            onclick="applyColorPreset('accent', '#10b981')"></div>
                        <div class="color-dot" style="background:#8b5cf6"
                            onclick="applyColorPreset('accent', '#8b5cf6')"></div>
                        <div class="color-dot" style="background:#ef4444"
                            onclick="applyColorPreset('accent', '#ef4444')"></div>
                    </div>
                </div>

                <div class="control-group">
                    <span class="control-label">æ–‡å­—é¢œè‰² (Global Text)</span>
                    <div style="display:flex; gap:10px; margin-top:5px">
                        <div class="color-dot" style="background:#333333" onclick="applyColorPreset('text', '#333333')">
                        </div>
                        <div class="color-dot" style="background:#000000" onclick="applyColorPreset('text', '#000000')">
                        </div>
                        <div class="color-dot" style="background:#1f2937" onclick="applyColorPreset('text', '#1f2937')">
                        </div>
                        <div class="color-dot" style="background:#ffffff; border:1px solid #ddd"
                            onclick="applyColorPreset('text', '#ffffff')"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-top:0">çª—å£å¤§å°</h3>
                <div class="control-group">
                    <span class="control-label">é€»è¾‘åˆ†è¾¨ç‡é¢„è®¾</span>
                    <select id="window-size-select" onchange="applyWindowSize(this.value)">
                        <option value="950x700">é»˜è®¤ (950 x 700)</option>
                        <option value="1280x720">720p - æ ‡æ¸… (1280 x 720)</option>
                        <option value="1600x900">1600x900 (æ¨è 4K å±å¹•ä½¿ç”¨)</option>
                        <option value="1920x1080">1080p - é«˜æ¸… (1920 x 1080)</option>
                        <option value="2560x1440">2K - è¶…å¤§ (æ³¨æ„ï¼šé«˜åˆ†å±ä¸‹å¯èƒ½å æ»¡å…¨å±)</option>
                    </select>
                    <div style="font-size:12px; margin-top:5px; opacity:0.7">
                        é€‰æ‹©åçª—å£å°†ç«‹å³è°ƒæ•´å¤§å°ï¼Œå¹¶ä½œä¸ºä¸‹æ¬¡å¯åŠ¨çš„é»˜è®¤å€¼ã€‚ä»£ç é€»è¾‘æ˜¯ï¼š ç”¨æˆ·é€‰æ‹©çš„æ•°å€¼ (é€»è¾‘) Ã— ç³»ç»Ÿç¼©æ”¾ (DPI) = è®¾ç½®ç»™ Windows çš„æ•°å€¼ (ç‰©ç†åˆ†è¾¨ç‡)
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-top:0">èƒŒæ™¯å›¾ç‰‡</h3>

                <div class="control-group">
                    <span class="control-label">å›¾ç‰‡æ¥æº</span>
                    <div class="control-row">
                        <button class="btn" onclick="selectBgImage()">é€‰æ‹©å›¾ç‰‡</button>
                        <button class="btn outline" onclick="restoreDefaultBg()">æ¢å¤é»˜è®¤å›¾ç‰‡</button>
                        <button class="btn danger-outline" onclick="clearBg()">æ¸…é™¤</button>
                    </div>
                </div>

                <div class="control-group">
                    <span class="control-label">æ˜¾ç¤ºæ¨¡å¼</span>
                    <select id="bg-mode-select" onchange="updateSettingsFromUI()">
                        <option value="cover">å¡«å…… (Cover) - æ¨è</option>
                        <option value="contain">é€‚åº” (Contain) - æ˜¾ç¤ºå®Œæ•´</option>
                        <option value="100% 100%">æ‹‰ä¼¸ (Stretch) - é“ºæ»¡å…¨å±</option>
                        <option value="auto">å±…ä¸­ (Center) - åŸå§‹å¤§å°</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-top:0">è§†è§‰æ•ˆæœ</h3>
                <div class="control-group">
                    <span class="control-label">æ•ˆæœé¢„è®¾</span>
                    <select id="visual-effect-select" onchange="applyVisualEffect(this.value, true)">
                        <option value="glass">æ¯›ç»ç’ƒ (Glass) - æ¨è</option>
                        <option value="semi">åŠé€æ˜ (Semi)</option>
                        <option value="transparent">å…¨é€æ˜ (Transparent) - æç®€</option>
                        <option value="none">æ— æ•ˆæœ (Flat) - çº¯è‰²</option>
                    </select>
                </div>
                <div class="control-group">
                    <span class="control-label">é®ç½©é€æ˜åº¦</span>
                    <div class="control-row">
                        <input type="range" id="mask-opacity-range" min="0" max="100" step="1"
                            oninput="updateSettingsFromUI()">
                        <span id="mask-opacity-val" style="width:40px; text-align:right">40%</span>
                    </div>
                </div>
                <div class="control-group">
                    <span class="control-label">èƒŒæ™¯æ¨¡ç³Šåº¦</span>
                    <div class="control-row">
                        <input type="range" id="blur-radius-range" min="0" max="15" step="1"
                            oninput="updateSettingsFromUI()">
                        <span id="blur-radius-val" style="width:40px; text-align:right">0px</span>
                    </div>
                </div>
            </div>

            <div style="text-align:center; margin-bottom: 20px;">
                <button class="btn outline" onclick="restoreDefaults()">âš ï¸ æ¢å¤æ‰€æœ‰é»˜è®¤è®¾ç½®</button>
            </div>
        </div>
    </div>

    <!-- ç‰ˆæœ¬ä¿¡æ¯ç»¼åˆå¼¹çª— -->
    <div id="update-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:20000; align-items:center; justify-content:center; backdrop-filter: blur(5px);">
        <div class="card"
            style="width:520px; max-width:92%; background:var(--card-bg); backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.5); box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-height:88vh; display:flex; flex-direction:column;">
            <h3 style="margin-top:0; display:flex; align-items:center; gap:10px; flex-shrink:0;">
                <svg class="icon" viewBox="0 0 24 24" style="color:var(--accent-color)">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                ç‰ˆæœ¬ä¿¡æ¯
            </h3>

            <!-- è·å–æ¥æºæç¤º -->
            <div id="fetch-warn-area" style="display:none; font-size:12px; background:rgba(245,158,11,0.12); border:1px solid rgba(245,158,11,0.4); border-radius:8px; padding:8px 12px; margin-bottom:10px; white-space:pre-line; flex-shrink:0;"></div>

            <!-- æ›´æ–°å™¨ç‰ˆæœ¬ä¿¡æ¯åŒº -->
            <div id="updater-info-area" style="display:none; flex-shrink:0; margin-bottom:10px; padding:10px 12px; background:rgba(59,130,246,0.08); border:1px solid rgba(59,130,246,0.3); border-radius:8px;">
                <div style="font-size:13px; font-weight:bold; margin-bottom:4px; color:#3b82f6;">ğŸ”§ æ›´æ–°å™¨æœ‰æ–°ç‰ˆæœ¬</div>
                <div id="updater-info-text" style="font-size:12px; opacity:0.85;"></div>
                <div style="margin-top:8px; display:flex; gap:8px;">
                    <button class="btn small" onclick="doUpdaterSelfUpdate()">ç«‹å³æ›´æ–°æ›´æ–°å™¨</button>
                    <button class="btn small outline" onclick="dismissUpdaterInfo()">æš‚ä¸æ›´æ–°</button>
                </div>
            </div>

            <!-- å®¢æˆ·ç«¯ç‰ˆæœ¬ä¿¡æ¯åŒº -->
            <div style="font-size:12px; opacity:0.7; margin-bottom:6px; flex-shrink:0;">
                å½“å‰å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼š<strong id="modal-local-ver"></strong>
                &nbsp;|&nbsp;æ›´æ–°å™¨ç‰ˆæœ¬ï¼š<strong id="modal-launcher-ver"></strong>
            </div>

            <div id="update-subtitle" style="font-size:13px; opacity:0.8; margin-bottom:10px; flex-shrink:0;">
                æ£€æµ‹åˆ°ä»¥ä¸‹æœªå®‰è£…ç‰ˆæœ¬ï¼Œè¯·é€‰æ‹©éœ€è¦æ›´æ–°çš„å†…å®¹ï¼š
            </div>

            <div id="update-list-content" class="update-list-container" style="overflow-y:auto; flex:1; min-height:0;">
            </div>

            <div id="progress-area" style="margin-bottom:20px; display:none; flex-shrink:0; margin-top:15px">
                <div style="font-size:12px; margin-bottom:5px; display:flex; justify-content:space-between;">
                    <span>ä¸‹è½½ä¸æ›´æ–°è¿›åº¦</span>
                    <span id="dl-percent">0%</span>
                </div>
                <div style="height:6px; background:rgba(0,0,0,0.1); border-radius:3px; overflow:hidden; margin-bottom: 8px;">
                    <div id="dl-bar" style="height:100%; width:0%; background:var(--accent-color); transition:width 0.2s;"></div>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:11px; opacity:0.7; font-family: 'Segoe UI', sans-serif;">
                    <span id="dl-status-text">å‡†å¤‡ä¸­...</span>
                    <span id="dl-speed-text" style="font-family:'Consolas', monospace;">0 KB/s</span>
                </div>
                <div style="margin-top:10px; text-align:right">
                    <button class="btn small danger-outline" onclick="closeUpdateModal()">å–æ¶ˆ / å…³é—­</button>
                </div>
            </div>

            <div id="btn-area"
                style="display:flex; gap:10px; justify-content:flex-end; flex-shrink:0; margin-top:10px; flex-wrap:wrap;">
                <button class="btn" onclick="triggerDownload('cn')">ğŸš€ CN åŠ é€Ÿæ›´æ–°</button>
                <button class="btn outline" onclick="triggerDownload('global')">ğŸŒ å…¨çƒèŠ‚ç‚¹</button>
                <button class="btn danger-outline" onclick="closeUpdateModal()">æš‚ä¸æ›´æ–°</button>
            </div>
        </div>
    </div>

    <!-- å¼ºåˆ¶æ‹‰å–å†å²ç‰ˆæœ¬å¼¹çª— -->
    <div id="force-update-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.55); z-index:20001; align-items:center; justify-content:center; backdrop-filter: blur(5px);">
        <div class="card"
            style="width:520px; max-width:92%; background:var(--card-bg); backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.5); box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-height:88vh; display:flex; flex-direction:column;">
            <h3 style="margin-top:0; display:flex; align-items:center; gap:10px; flex-shrink:0; color:#ef4444;">
                <svg class="icon" viewBox="0 0 24 24" style="color:#ef4444">
                    <path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                å¼ºåˆ¶æ‹‰å–å†å²ç‰ˆæœ¬æ›´æ–°
            </h3>
            <div style="font-size:12px; background:rgba(239,68,68,0.08); border:1px solid rgba(239,68,68,0.3); border-radius:8px; padding:8px 12px; margin-bottom:12px; flex-shrink:0; line-height:1.6;">
                <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong>ç”¨äºä½ æ˜ç¡®çŸ¥é“æ“ä½œç›®çš„ï¼Œæƒ³è¦å¼ºåˆ¶é‡æ–°åº”ç”¨æŸä¸€æ¬¡å†å²æ›´æ–°çš„æƒ…å†µã€‚<br>
                è¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨ä¿®æ”¹æ—¶é—´æˆ³ç‰ˆæœ¬å·æ¥å®ç°è¿˜åŸã€‚<br>
                <strong>âš ï¸ æ³¨æ„ï¼š</strong>å¼ºåˆ¶æ‹‰å–æ—¶ä¼šå¿½ç•¥å½“å‰ç‰ˆæœ¬å·ï¼Œç›´æ¥åº”ç”¨æ‰€é€‰ç‰ˆæœ¬çš„æ›´æ–°è§„åˆ™ã€‚<br>
                è¯·ä»ä¸‹æ–¹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬ï¼Œç„¶åç‚¹å‡»æ›´æ–°æŒ‰é’®ã€‚
            </div>
            <div style="font-size:13px; opacity:0.8; margin-bottom:8px; flex-shrink:0;">é€‰æ‹©è¦å¼ºåˆ¶é‡æ–°åº”ç”¨çš„ç‰ˆæœ¬ï¼š</div>
            <div id="force-update-list" class="update-list-container" style="overflow-y:auto; flex:1; min-height:0;">
            </div>
            <div id="force-progress-area" style="margin-bottom:20px; display:none; flex-shrink:0; margin-top:15px">
                <div style="font-size:12px; margin-bottom:5px; display:flex; justify-content:space-between;">
                    <span>å¼ºåˆ¶æ›´æ–°è¿›åº¦</span>
                    <span id="force-dl-percent">0%</span>
                </div>
                <div style="height:6px; background:rgba(0,0,0,0.1); border-radius:3px; overflow:hidden; margin-bottom: 8px;">
                    <div id="force-dl-bar" style="height:100%; width:0%; background:#ef4444; transition:width 0.2s;"></div>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:11px; opacity:0.7;">
                    <span id="force-dl-status">å‡†å¤‡ä¸­...</span>
                    <span id="force-dl-speed" style="font-family:'Consolas', monospace;">0 KB/s</span>
                </div>
            </div>
            <div id="force-btn-area"
                style="display:flex; gap:10px; justify-content:flex-end; flex-shrink:0; margin-top:10px; flex-wrap:wrap;">
                <button class="btn" style="background:#ef4444; border-color:#ef4444;" onclick="triggerForceDownload('cn')">ğŸš€ CN åŠ é€Ÿå¼ºåˆ¶æ›´æ–°</button>
                <button class="btn outline" onclick="triggerForceDownload('global')">ğŸŒ å…¨çƒèŠ‚ç‚¹</button>
                <button class="btn danger-outline" onclick="closeForceUpdateModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- è¿æ¥æ£€æŸ¥ç»“æœå¼¹çª— -->
    <div id="fetch-result-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.55); z-index:20002; align-items:center; justify-content:center; backdrop-filter: blur(5px);">
        <div class="card"
            style="width:560px; max-width:92%; background:var(--card-bg); backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,0.5); box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-height:85vh; display:flex; flex-direction:column; padding:20px;">
            <h3 style="margin-top:0; display:flex; align-items:center; gap:10px; flex-shrink:0;">
                <svg class="icon" viewBox="0 0 24 24" style="color:var(--accent-color)">
                    <path d="M1 6l10.5 7.5L22 6"></path>
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                </svg>
                ç‰ˆæœ¬ä¿¡æ¯è·å–ç»“æœ
            </h3>
            <div id="fetch-result-content" style="overflow-y:auto; flex:1; min-height:0;">
            </div>
        </div>
    </div>

    <script>
        let currentSettings = { bg_type: 'default', custom_bg_data: '', visual_effect: 'glass', mask_opacity: 40, blur_radius: 0, text_color: '#333333', accent_color: '#f59e0b', bg_mode: 'cover', font_family: "'Segoe UI', system-ui, sans-serif", mirror_prefix: "https://gh-proxy.org/", custom_latest_url: "", custom_updater_url: "" };
        let localVersion = "26.02.06.15.24";
        let saveTimer;
        let scrollTimer;
        let pendingUpdates = [];

        function initApp(data) {
            // 1. åŸºç¡€æ–‡æœ¬ä¿¡æ¯æ˜¾ç¤º
            document.getElementById('target-version-name').innerText = data.versionName;
            if (data.localVersion) {
                localVersion = data.localVersion;
                document.getElementById('current-ver-display').innerText = localVersion;
            }
            if (data.launcherVersion) {
                document.getElementById('launcher-ver-display').innerText = data.launcherVersion;
            }

            // 2. å°†åç«¯ä¼ æ¥çš„è®¾ç½®åˆå¹¶åˆ°å½“å‰å˜é‡
            currentSettings = { ...currentSettings, ...data.settings };

            // 3. è®¾ç½®èƒŒæ™¯å›¾ (CSSå˜é‡)
            const bgImg = data.bgImage ? `url('${data.bgImage}')` : 'none';
            document.documentElement.style.setProperty('--bg-image', bgImg);

            // ============================================================
            // ğŸ› ï¸ å…³é”®ä¿®å¤ï¼šå…¨é‡åŒæ­¥ UI æ§ä»¶çŠ¶æ€
            // å¿…é¡»åœ¨è°ƒç”¨ updateSettingsFromUI() ä¹‹å‰å®Œæˆï¼Œé˜²æ­¢é»˜è®¤å€¼è¦†ç›–é…ç½®
            // ============================================================

            // A. ä¿®å¤ä¸‹æ‹‰èœå• (Select) çš„çŠ¶æ€ä¸¢å¤±
            if (currentSettings.visual_effect) {
                document.getElementById('visual-effect-select').value = currentSettings.visual_effect;
            }
            if (currentSettings.bg_mode) {
                document.getElementById('bg-mode-select').value = currentSettings.bg_mode;
            }
            if (currentSettings.font_family) {
                document.getElementById('font-select').value = currentSettings.font_family;
            }

            // B. ä¿®å¤æ»‘åŠ¨æ¡ (Range) çš„æ•°å€¼é”™è¯¯ (ä¹‹å‰æåˆ°çš„ 50% å’Œ 8px é—®é¢˜)
            // æ³¨æ„ï¼šè¦æ£€æŸ¥å€¼æ˜¯å¦å­˜åœ¨ï¼Œå› ä¸ºæ—§ç‰ˆé…ç½®æ–‡ä»¶å¯èƒ½æ²¡æœ‰è¿™äº›å­—æ®µ
            if (currentSettings.mask_opacity !== undefined) {
                document.getElementById('mask-opacity-range').value = currentSettings.mask_opacity;
            }
            if (currentSettings.blur_radius !== undefined) {
                document.getElementById('blur-radius-range').value = currentSettings.blur_radius;
            }

            // C. ä¿®å¤æ–‡æœ¬è¾“å…¥æ¡† (Input) çš„å†…å®¹ä¸¢å¤±
            // å¦‚æœä¸å¡«å›å»ï¼ŒupdateSettingsFromUI ä¼šè¯»åˆ°ç©ºå­—ç¬¦ä¸²ï¼Œä»è€Œæ¸…ç©ºç”¨æˆ·çš„åŠ é€Ÿæºé…ç½®
            if (currentSettings.mirror_prefix) {
                document.getElementById('mirror-prefix-input').value = currentSettings.mirror_prefix;
            }

            // D. å›æ˜¾è‡ªå®šä¹‰æ›´æ–°æº URL è¾“å…¥æ¡†
            if (currentSettings.custom_latest_url) {
                document.getElementById('custom-latest-url-input').value = currentSettings.custom_latest_url;
            }
            if (currentSettings.custom_updater_url) {
                document.getElementById('custom-updater-url-input').value = currentSettings.custom_updater_url;
            }

            // === å›æ˜¾çª—å£å¤§å° ===
            if (currentSettings.window_size) {
                const sizeSelect = document.getElementById('window-size-select');
                if (sizeSelect) {
                    sizeSelect.value = currentSettings.window_size;

                    // å®¹é”™ï¼šå¦‚æœé…ç½®æ–‡ä»¶é‡Œçš„å°ºå¯¸ä¸åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼ˆæ¯”å¦‚æ‰‹åŠ¨æ”¹äº†jsonï¼‰ï¼Œ
                    // æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶ option æˆ–è€…ä»…ä»…ä¿æŒé»˜è®¤ã€‚
                    // ç®€å•å¤„ç†ï¼šå¦‚æœ value æ²¡å˜ï¼ˆè¯´æ˜æ²¡åŒ¹é…åˆ°ï¼‰ï¼Œå°±å¼ºåˆ¶é€‰å›é»˜è®¤æˆ–è€…æ·»åŠ ä¸€ä¸ª option
                    if (sizeSelect.value !== currentSettings.window_size) {
                        // è¿™æ˜¯ä¸€ä¸ªé«˜çº§ä¼˜åŒ–ï¼Œå¯é€‰ï¼šå¦‚æœä¸åœ¨åˆ—è¡¨ä¸­ï¼Œæ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªâ€œè‡ªå®šä¹‰â€é€‰é¡¹
                        const opt = new Option(`è‡ªå®šä¹‰ (${currentSettings.window_size})`, currentSettings.window_size);
                        sizeSelect.add(opt);
                        sizeSelect.value = currentSettings.window_size;
                    }
                }
            }

            // ============================================================
            // 4. UI æ§ä»¶å€¼å·²çº æ­£ï¼Œç°åœ¨å¯ä»¥å®‰å…¨æ‰§è¡Œ UI æ›´æ–°é€»è¾‘äº†
            updateSettingsFromUI();

            // 5. è·¯å¾„æ£€æŸ¥ä¸å…¶ä»–åˆå§‹åŒ–
            pywebview.api.check_path().then(valid => {
                if (!valid) {
                    document.getElementById('path-warning').style.display = 'flex';
                    document.getElementById('path-success').style.display = 'none';
                } else {
                    document.getElementById('path-warning').style.display = 'none';
                    if (data.detectedPath) {
                        document.getElementById('detected-path-text').innerText = data.detectedPath;
                        document.getElementById('path-success').style.display = 'flex';
                    }
                }
            });

            // 6. åˆ·æ–°ç‰ˆæœ¬åˆ—è¡¨
            refreshVersions();

            // 7. æ¸²æŸ“è½®è¯¢åœ°å€åˆ—è¡¨
            refreshUrlLists();
        }

        // ... (windowControls, switchTab, updateSettingsFromUI ç­‰ä¿æŒä¸å˜) ...
        function windowControls(action) {
            if (action === 'min') pywebview.api.min_window();
            else if (action === 'max') pywebview.api.max_window();
            else if (action === 'close') pywebview.api.close_window();
        }
        function switchTab(tabId) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            const targetNav = document.getElementById('nav-' + tabId);
            if (targetNav) targetNav.classList.add('active');
            const targetPage = document.getElementById('page-' + tabId);
            if (targetPage) targetPage.classList.add('active');
            if (tabId === 'mods' || tabId === 'config') loadFiles(tabId);
        }
        function applyWindowSize(val) {
            if (!val) return;
            const parts = val.split('x');
            if (parts.length === 2) {
                const w = parts[0];
                const h = parts[1];

                // 1. è°ƒç”¨åç«¯è°ƒæ•´å¤§å°
                pywebview.api.set_window_size(w, h);

                // 2. æ›´æ–°å†…å­˜ä¸­çš„ settings å˜é‡ï¼Œç¡®ä¿å’Œå…¶ä»–è®¾ç½®åŒæ­¥
                currentSettings.window_size = val;

                // 3. æç¤ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
                // addLog(`çª—å£å¤§å°å·²è°ƒæ•´ä¸º: ${w} x ${h}`);
            }
        }

        function updateSettingsFromUI() {
            const effect = document.getElementById('visual-effect-select').value;
            const opacity = document.getElementById('mask-opacity-range').value;
            const blur = document.getElementById('blur-radius-range').value;
            const bgMode = document.getElementById('bg-mode-select').value;
            const fontFamily = document.getElementById('font-select').value;
            const mirrorPrefix = document.getElementById('mirror-prefix-input').value;
            const customLatestUrl = document.getElementById('custom-latest-url-input').value.trim();
            const customUpdaterUrl = document.getElementById('custom-updater-url-input').value.trim();

            document.getElementById('mask-opacity-val').innerText = opacity + '%';
            document.getElementById('blur-radius-val').innerText = blur + 'px';

            const root = document.documentElement;
            root.style.setProperty('--bg-blur', blur + 'px');
            root.style.setProperty('--mask-opacity', opacity / 100);
            root.style.setProperty('--bg-size', bgMode);
            root.style.setProperty('--font-family', fontFamily);

            root.style.setProperty('--text-color', currentSettings.text_color);
            root.style.setProperty('--accent-color', currentSettings.accent_color);

            document.querySelectorAll('.color-dot').forEach(dot => {
                dot.classList.remove('active');
                if (rgbToHex(dot.style.backgroundColor) === currentSettings.accent_color || rgbToHex(dot.style.backgroundColor) === currentSettings.text_color) {
                    dot.classList.add('active');
                }
            });

            const sidebar = document.querySelector('.sidebar');
            const body = document.body;

            sidebar.style.borderRight = '1px solid var(--border-color)';
            root.style.setProperty('--card-border', '1px solid rgba(255, 255, 255, 0.4)');
            root.style.setProperty('--text-shadow', 'none');
            body.classList.remove('transparent-mode');

            const winBtns = document.querySelectorAll('.win-btn');
            winBtns.forEach(btn => btn.style.color = currentSettings.text_color);

            // å¤„ç† visual-effect çš„é€»è¾‘
            if (effect === 'none') {
                sidebar.style.background = '#f9fafb';
                sidebar.style.backdropFilter = 'none';
                root.style.setProperty('--card-bg', '#ffffff');

                // å…³é—­å¡ç‰‡æ¨¡ç³Š
                root.style.setProperty('--card-blur', '0px');

            } else if (effect === 'glass') {
                sidebar.style.background = 'rgba(255,255,255,0.65)';
                sidebar.style.backdropFilter = 'blur(20px)';
                root.style.setProperty('--card-bg', 'rgba(255,255,255,0.65)');

                // å¼€å¯å¡ç‰‡æ¨¡ç³Š (åªæœ‰ Glass æ¨¡å¼æ‰å¼€)
                root.style.setProperty('--card-blur', '12px');

            } else if (effect === 'semi') {
                sidebar.style.background = 'rgba(255,255,255,0.9)';
                sidebar.style.backdropFilter = 'none';
                root.style.setProperty('--card-bg', 'rgba(255,255,255,0.9)');

                // åŠé€æ˜æ¨¡å¼é€šå¸¸ä¸éœ€è¦æ¨¡ç³Šï¼Œä¿æŒæ¸…æ™°
                root.style.setProperty('--card-blur', '0px');

            } else if (effect === 'transparent') {
                body.classList.add('transparent-mode');
                sidebar.style.background = 'transparent';
                sidebar.style.backdropFilter = 'none';
                sidebar.style.borderRight = 'none';

                // é€æ˜æ¨¡å¼ï¼šèƒŒæ™¯ææ·¡ï¼Œä¸”ç»å¯¹ä¸èƒ½æœ‰æ¨¡ç³Š
                root.style.setProperty('--card-bg', 'rgba(255,255,255,0.1)');
                root.style.setProperty('--card-border', '1px solid rgba(255, 255, 255, 0.3)');
                root.style.setProperty('--text-shadow', '0 0 3px rgba(255, 255, 255, 0.8), 0 0 5px rgba(255,255,255,0.5)');

                // å½»åº•å…³é—­æ¨¡ç³Šï¼Œå®ç°å…¨é€æ˜
                root.style.setProperty('--card-blur', '0px');
            }

            currentSettings.visual_effect = effect;
            currentSettings.mask_opacity = parseInt(opacity);
            currentSettings.blur_radius = parseInt(blur);
            currentSettings.bg_mode = bgMode;
            currentSettings.font_family = fontFamily;
            currentSettings.mirror_prefix = mirrorPrefix;
            currentSettings.custom_latest_url = customLatestUrl;
            currentSettings.custom_updater_url = customUpdaterUrl;

            saveSettingsDebounced();
        }
        function saveSettingsDebounced() { clearTimeout(saveTimer); saveTimer = setTimeout(() => { pywebview.api.save_settings(JSON.stringify(currentSettings)); }, 500); }

        function rgbToHex(rgb) {
            if (rgb.startsWith('#')) return rgb;
            const rgbValues = rgb.match(/\d+/g);
            if (!rgbValues) return rgb;
            return "#" + ((1 << 24) + (parseInt(rgbValues[0]) << 16) + (parseInt(rgbValues[1]) << 8) + parseInt(rgbValues[2])).toString(16).slice(1);
        }

        function applyColorPreset(type, color) {
            if (type === 'accent') {
                currentSettings.accent_color = color;
            } else if (type === 'text') {
                currentSettings.text_color = color;
            }
            updateSettingsFromUI();
        }

        function applyVisualEffect(val, userTriggered) {
            if (userTriggered) {
                if (val === 'glass') {
                    document.getElementById('mask-opacity-range').value = 40;
                    document.getElementById('blur-radius-range').value = 0;
                } else if (val === 'transparent') {
                    document.getElementById('mask-opacity-range').value = 10;
                }
            }
            updateSettingsFromUI();
        }

        function restoreDefaults() {
            if (confirm("ç¡®å®šè¦æ¢å¤æ‰€æœ‰ç•Œé¢è®¾ç½®åˆ°é»˜è®¤çŠ¶æ€å—ï¼Ÿ")) {
                // ä¿ç•™éç•Œé¢ç±»è®¾ç½®ï¼Œé¿å…é‡ç½®æ—¶ä¸¢å¤±ç‰ˆæœ¬è·³è¿‡è®°å½•å’Œçª—å£å¤§å°
                const preservedSkipped = currentSettings.skipped_versions || [];
                const preservedWindowSize = currentSettings.window_size || "950x700";

                currentSettings = {
                    bg_type: 'default', custom_bg_data: '',
                    visual_effect: 'glass', mask_opacity: 40, blur_radius: 0,
                    text_color: '#333333', accent_color: '#f59e0b',
                    bg_mode: 'cover', font_family: "'Segoe UI', system-ui, sans-serif",
                    current_version: localVersion,
                    mirror_prefix: "https://gh-proxy.org/",
                    custom_latest_url: "",
                    custom_updater_url: "",
                    skipped_versions: preservedSkipped,
                    window_size: preservedWindowSize
                };
                document.getElementById('visual-effect-select').value = 'glass';
                document.getElementById('mask-opacity-range').value = 40;
                document.getElementById('blur-radius-range').value = 0;
                document.getElementById('bg-mode-select').value = 'cover';
                document.getElementById('font-select').value = "'Segoe UI', system-ui, sans-serif";
                document.getElementById('mirror-prefix-input').value = "https://gh-proxy.org/";
                document.getElementById('custom-latest-url-input').value = "";
                document.getElementById('custom-updater-url-input').value = "";
                restoreDefaultBg();
                updateSettingsFromUI();
            }
        }

        /**
         * æ¢å¤é»˜è®¤æ›´æ–°æºåœ°å€
         * ä»…é‡ç½® latest.json å’Œ Updater-latest.json çš„è‡ªå®šä¹‰ URLï¼Œä¸å½±å“å…¶ä»–è®¾ç½®
         */
        function restoreDefaultUpdateUrls() {
            if (confirm("ç¡®å®šè¦å°†æ›´æ–°æºåœ°å€æ¢å¤ä¸ºé»˜è®¤å€¼å—ï¼Ÿ")) {
                currentSettings.custom_latest_url = "";
                currentSettings.custom_updater_url = "";
                document.getElementById('custom-latest-url-input').value = "";
                document.getElementById('custom-updater-url-input').value = "";
                saveSettingsDebounced();
                refreshUrlLists();
            }
        }

        // === å›ºå®šçš„ GitHub åœ°å€å¸¸é‡ï¼ˆä¸ Python åç«¯ä¿æŒä¸€è‡´ï¼‰===
        const GITHUB_LATEST_URL = "https://github.com/KanameMadoka520/TCY-Client-Updater/releases/download/versions/latest.json";
        const GITHUB_UPDATER_URL = "https://github.com/KanameMadoka520/TCY-Client-Updater/releases/download/versions/Updater-latest.json";
        const DEFAULT_LATEST_URL = "https://tcymc.space/update/latest.json";
        const DEFAULT_UPDATER_URL = "https://tcymc.space/update/Updater-latest.json";

        function buildUrlList(defaultUrl, githubUrl, customUrl, mirrorPrefix) {
            const urls = [];
            if (customUrl) urls.push(customUrl);
            urls.push(defaultUrl);
            urls.push(githubUrl);
            if (mirrorPrefix && !githubUrl.startsWith(mirrorPrefix)) {
                urls.push(mirrorPrefix + githubUrl);
            }
            // å»é‡ä¿åº
            return [...new Map(urls.map(u => [u, u])).values()];
        }

        function refreshUrlLists() {
            const mirror = (currentSettings.mirror_prefix || "https://gh-proxy.org/").trim();
            const customLatest = (currentSettings.custom_latest_url || "").trim();
            const customUpdater = (currentSettings.custom_updater_url || "").trim();

            const latestUrls = buildUrlList(DEFAULT_LATEST_URL, GITHUB_LATEST_URL, customLatest, mirror);
            const updaterUrls = buildUrlList(DEFAULT_UPDATER_URL, GITHUB_UPDATER_URL, customUpdater, mirror);

            function renderList(urls, customUrl) {
                return urls.map((u, i) => {
                    let tag = '';
                    if (u === customUrl) tag = ' <span style="color:#f59e0b; font-size:10px;">[è‡ªå®šä¹‰]</span>';
                    else if (u === DEFAULT_LATEST_URL || u === DEFAULT_UPDATER_URL) tag = ' <span style="color:#64748b; font-size:10px;">[å®˜ç½‘é»˜è®¤]</span>';
                    else if (u === GITHUB_LATEST_URL || u === GITHUB_UPDATER_URL) tag = ' <span style="color:#6366f1; font-size:10px;">[GitHub]</span>';
                    else tag = ' <span style="color:#10b981; font-size:10px;">[GitHub+åŠ é€Ÿ]</span>';
                    return `<div>${i + 1}. ${u}${tag}</div>`;
                }).join('');
            }

            document.getElementById('latest-url-list').innerHTML = renderList(latestUrls, customLatest);
            document.getElementById('updater-url-list').innerHTML = renderList(updaterUrls, customUpdater);
        }

        // === è¿æ¥æ£€æŸ¥ç»“æœå¼¹çª— ===
        let _pendingVersionModal = null;

        function showFetchResultDialog(result) {
            const { client, updater, all_failed } = result;

            function renderRows(label, urls, ok, fail) {
                return urls.map(u => {
                    const isOk = ok.includes(u);
                    const icon = isOk ? 'âœ…' : 'âŒ';
                    return `<tr>
                        <td style="padding:3px 6px; white-space:nowrap;">${icon}</td>
                        <td style="padding:3px 6px; font-family:'Consolas',monospace; font-size:11px; word-break:break-all;">${u}</td>
                        <td style="padding:3px 6px; white-space:nowrap; font-size:11px; opacity:0.7;">${label}</td>
                    </tr>`;
                }).join('');
            }

            const rows = renderRows('å®¢æˆ·ç«¯ç‰ˆæœ¬', client.urls, client.ok, client.fail)
                       + renderRows('æ›´æ–°å™¨ç‰ˆæœ¬', updater.urls, updater.ok, updater.fail);

            const okCount = client.ok.length + updater.ok.length;
            const totalCount = client.urls.length + updater.urls.length;

            let statusMsg, statusColor;
            if (all_failed) {
                statusMsg = 'â›” æ‰€æœ‰åœ°å€å‡æ— æ³•è¿æ¥ï¼Œè¯·è”ç³»ç³–é†‹é±¼ï¼';
                statusColor = '#ef4444';
            } else {
                statusMsg = `âœ… å·²æˆåŠŸè¿æ¥ ${okCount} / ${totalCount} ä¸ªåœ°å€ï¼Œæ›´æ–°åŠŸèƒ½æ­£å¸¸å¯ç”¨ã€‚`;
                statusColor = '#10b981';
            }

            const html = `
                <div style="font-size:13px; margin-bottom:10px; color:${statusColor}; font-weight:bold;">${statusMsg}</div>
                <div style="font-size:12px; margin-bottom:10px; opacity:0.75;">
                    è‡³å°‘æœ‰ä¸€ä¸ªé“¾æ¥èƒ½æ‹‰å–åˆ°ä¿¡æ¯å°±æ˜¯æ­£å¸¸çš„ï¼Œå¦åˆ™è”ç³»ç³–é†‹é±¼ã€‚
                </div>
                <div style="overflow-x:auto; max-height:260px; overflow-y:auto;">
                    <table style="width:100%; border-collapse:collapse; font-size:12px;">
                        <thead>
                            <tr style="border-bottom:1px solid rgba(0,0,0,0.1);">
                                <th style="padding:4px 6px; text-align:left; opacity:0.6;">çŠ¶æ€</th>
                                <th style="padding:4px 6px; text-align:left; opacity:0.6;">åœ°å€</th>
                                <th style="padding:4px 6px; text-align:left; opacity:0.6;">ç”¨é€”</th>
                            </tr>
                        </thead>
                        <tbody>${rows}</tbody>
                    </table>
                </div>
                <div style="margin-top:14px; text-align:right;">
                    <button class="btn small" onclick="closeFetchResultDialog()">${all_failed ? 'å…³é—­' : 'ç¡®å®šï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯'}</button>
                </div>`;

            document.getElementById('fetch-result-content').innerHTML = html;
            document.getElementById('fetch-result-modal').style.display = 'flex';
        }

        function closeFetchResultDialog() {
            document.getElementById('fetch-result-modal').style.display = 'none';
            if (_pendingVersionModal) {
                const payload = _pendingVersionModal;
                _pendingVersionModal = null;
                showCombinedVersionModal(payload);
            }
        }

        function setPendingVersionModal(payload) {
            _pendingVersionModal = payload;
        }

        /**
                 * ğŸ–¼ï¸ é€‰æ‹©è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡
                 * è°ƒç”¨åç«¯æ–‡ä»¶é€‰æ‹©å¼¹çª—ï¼Œå¹¶å°†é€‰ä¸­çš„å›¾ç‰‡è½¬æ¢ä¸º Base64 åº”ç”¨åˆ°ç•Œé¢
                 */
        function selectBgImage() {
            // è°ƒç”¨ Python åç«¯æ¥å£å¼¹å‡ºæ–‡ä»¶é€‰æ‹©æ¡†
            pywebview.api.select_custom_image().then(b64 => {
                // å¦‚æœ b64 æœ‰å€¼ï¼ˆè¯´æ˜ç”¨æˆ·é€‰ä¸­äº†å›¾ç‰‡ï¼Œæ²¡æœ‰ç‚¹å–æ¶ˆï¼‰
                if (b64) {
                    // 1. æ›´æ–°å½“å‰å†…å­˜ä¸­çš„è®¾ç½®å¯¹è±¡
                    currentSettings.bg_type = 'custom';      // æ ‡è®°ç±»å‹ä¸ºè‡ªå®šä¹‰
                    currentSettings.custom_bg_data = b64;    // ä¿å­˜ Base64 æ•°æ®

                    // 2. å®æ—¶æ›´æ–° CSS å˜é‡ï¼Œè®©èƒŒæ™¯ç«‹å³ç”Ÿæ•ˆ
                    document.documentElement.style.setProperty('--bg-image', `url('${b64}')`);

                    // 3. è§¦å‘é˜²æŠ–ä¿å­˜ï¼ˆå†™å…¥ json æ–‡ä»¶ï¼‰
                    saveSettingsDebounced();
                }
            });
        }

        /**
         * ğŸ”™ æ¢å¤é»˜è®¤èƒŒæ™¯
         * ä»åç«¯è·å–é»˜è®¤çš„èƒŒæ™¯å›¾ç‰‡æ•°æ®å¹¶åº”ç”¨
         */
        function restoreDefaultBg() {
            // è¯·æ±‚åç«¯è·å–é»˜è®¤å›¾ç‰‡çš„ Base64 æ•°æ®
            pywebview.api.get_default_bg().then(b64 => {
                // 1. æ›´æ–°è®¾ç½®çŠ¶æ€
                currentSettings.bg_type = 'default';

                // 2. æ›´æ–° CSS å˜é‡
                document.documentElement.style.setProperty('--bg-image', `url('${b64}')`);

                // 3. ä¿å­˜è®¾ç½®
                saveSettingsDebounced();
            });
        }

        /**
         * ğŸ—‘ï¸ æ¸…é™¤èƒŒæ™¯
         * ç§»é™¤æ‰€æœ‰èƒŒæ™¯å›¾ç‰‡ï¼Œæ˜¾ç¤ºçº¯è‰²æˆ–é€æ˜
         */
        function clearBg() {
            // 1. æ›´æ–°è®¾ç½®çŠ¶æ€ä¸º 'none'
            currentSettings.bg_type = 'none';
            // 2. å°† CSS å˜é‡è®¾ä¸º none
            document.documentElement.style.setProperty('--bg-image', 'none');
            // 3. ä¿å­˜è®¾ç½®
            saveSettingsDebounced();
        }

        // ===æ–‡ä»¶åˆ—è¡¨ç¼“å­˜ï¼Œç”¨äºå‰ç«¯æœç´¢ ===
        let filesCache = { mods: [], config: [] };

        function loadFiles(type) {
            // åŠ è½½å‰å…ˆæ¸…ç©ºæœç´¢æ¡†ï¼Œé¿å…é€»è¾‘æ··ä¹±
            const searchInput = document.getElementById('search-' + type);
            if (searchInput) searchInput.value = '';

            const container = document.getElementById(type + '-list');
            container.innerHTML = '<div style="color:#666;text-align:center;padding:20px;">æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...æ‚¨çœŸçš„æŠŠæ›´æ–°å™¨æ”¾å¯¹åœ°æ–¹äº†å—</div>';

            pywebview.api.list_files(type).then(items => {
                // 1. å­˜å…¥ç¼“å­˜
                filesCache[type] = items;
                // 2. æ¸²æŸ“å…¨é‡åˆ—è¡¨
                renderFileList(type, items);
            });
        }

        // ===ç‹¬ç«‹çš„æ¸²æŸ“å‡½æ•° (æ”¯æŒæœç´¢ç»“æœæ¸²æŸ“) ===
        function renderFileList(type, items, isSearchMode = false) {
            const container = document.getElementById(type + '-list');
            container.innerHTML = '';

            if (!items || items.length === 0) {
                container.innerHTML = '<div style="color:#666;text-align:center;padding:20px;">æš‚æ— æ–‡ä»¶ (æœªæ‰¾åˆ°åŒ¹é…é¡¹)</div>';
                return;
            }

            // é€’å½’æ¸²æŸ“å‡½æ•°
            function render(node, parent) {
                node.forEach(item => {
                    const div = document.createElement('div');

                    if (item.type === 'folder') {
                        div.className = 'folder-item';
                        // å¦‚æœæ˜¯æœç´¢æ¨¡å¼ï¼Œé»˜è®¤å±•å¼€æ–‡ä»¶å¤¹ï¼Œæ–¹ä¾¿æŸ¥çœ‹ç»“æœ
                        if (isSearchMode) div.classList.add('open');

                        const icon = '<svg class="icon" style="width:14px;height:14px;margin-right:5px;fill:#fbbf24;stroke:none" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>';

                        div.innerHTML = `<div class="folder-header" onclick="this.parentElement.classList.toggle('open')">${icon} ${item.name}</div><div class="folder-content"></div>`;

                        // é€’å½’æ¸²æŸ“å­èŠ‚ç‚¹
                        render(item.children, div.querySelector('.folder-content'));
                    } else {
                        div.className = 'file-item';
                        const dbClickAttr = (type === 'config') ? `ondblclick="pywebview.api.open_file('${type}', '${item.path.replace(/\\/g, '\\\\')}')" title="åŒå‡»å³å¯æ‰“å¼€æ–‡ä»¶"` : '';

                        // é«˜äº®æœç´¢å…³é”®å­— (å¯é€‰ä¼˜åŒ–)
                        let displayName = item.name;

                        let html = `<div style="display:flex;align-items:center;gap:10px;flex:1" ${dbClickAttr}>
                                            <span>${displayName}</span>
                                            <span style="opacity:0.6;font-size:12px">${item.size}</span>
                                        </div>`;

                        if (type === 'mods') {
                            html += `<button class="btn danger-outline small" onclick="deleteFile('${type}', '${item.path.replace(/\\/g, '\\\\')}', '${item.name}')">åˆ é™¤</button>`;
                        }
                        div.innerHTML = html;
                    }
                    parent.appendChild(div);
                });
            }

            render(items, container);
        }

        // ===æœç´¢è¿‡æ»¤å‡½æ•° (æ”¯æŒæ­£åˆ™) ===
        function filterFiles(type, query) {
            const rawData = filesCache[type];
            if (!query) {
                renderFileList(type, rawData, false);
                return;
            }

            try {
                // åˆ›å»ºæ­£åˆ™å¯¹è±¡ï¼Œ'i' è¡¨ç¤ºå¿½ç•¥å¤§å°å†™
                const regex = new RegExp(query, 'i');
                const filteredData = filterTreeData(rawData, regex);
                renderFileList(type, filteredData, true); // true è¡¨ç¤ºå¼€å¯æœç´¢æ¨¡å¼(è‡ªåŠ¨å±•å¼€æ–‡ä»¶å¤¹)
            } catch (e) {
                // å¦‚æœæ­£åˆ™è¯­æ³•é”™è¯¯(æ¯”å¦‚è¾“å…¥äº†å•ä¸ª'[')ï¼Œæš‚æ—¶ä¸å¤„ç†æˆ–æ˜¾ç¤ºé”™è¯¯
                // console.warn("Invalid Regex", e);
            }
        }

        // ===é€’å½’è¿‡æ»¤æ ‘å½¢ç»“æ„æ•°æ® ===
        function filterTreeData(nodes, regex) {
            let result = [];
            for (let node of nodes) {
                if (node.type === 'folder') {
                    // å…ˆé€’å½’è¿‡æ»¤å­èŠ‚ç‚¹
                    let matchingChildren = filterTreeData(node.children, regex);

                    // é€»è¾‘ï¼šå¦‚æœæ–‡ä»¶å¤¹åå­—åŒ¹é…ï¼Œæˆ–è€…å®ƒé‡Œé¢æœ‰åŒ¹é…çš„æ–‡ä»¶ï¼Œå°±ä¿ç•™è¿™ä¸ªæ–‡ä»¶å¤¹
                    if (regex.test(node.name) || matchingChildren.length > 0) {
                        // æµ…æ‹·è´èŠ‚ç‚¹ï¼Œé¿å…ä¿®æ”¹åŸå§‹ç¼“å­˜æ•°æ®
                        let newNode = { ...node, children: matchingChildren };
                        result.push(newNode);
                    }
                } else {
                    // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œç›´æ¥æµ‹åå­—
                    if (regex.test(node.name)) {
                        result.push(node);
                    }
                }
            }
            return result;
        }

        function deleteFile(type, path, name) {
            if (confirm(`äºŒçº§ç¡®è®¤ï¼šæ‚¨ç¡®å®šè¦æ°¸ä¹…åˆ é™¤ â€œ${name}â€ å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                pywebview.api.delete_file(type, path).then(success => {
                    if (success) {
                        // åˆ é™¤æˆåŠŸåé‡æ–°åŠ è½½ï¼Œåˆ·æ–°ç¼“å­˜
                        loadFiles(type);
                    } else {
                        alert('åˆ é™¤å¤±è´¥ï¼Œå¯èƒ½æ–‡ä»¶è¢«å ç”¨æˆ–æƒé™ä¸è¶³ã€‚');
                    }
                });
            }
        }

        function openShortcut(type) { pywebview.api.open_shortcut_folder(type); }
        function openUrl(url) { pywebview.api.open_url(url); }
        function addLog(msg) { const box = document.getElementById('log-container'); box.innerHTML += `<div>${msg}</div>`; box.scrollTop = box.scrollHeight; }
        function refreshVersions() { pywebview.api.scan_versions().then(vs => { const sel = document.getElementById('version-select'); sel.innerHTML = ''; vs.forEach(v => sel.add(new Option(v, v))); }); }
        function startUpdate() { const v = document.getElementById('version-select').value; if (v && confirm('ç¡®å®šæ›´æ–°ï¼Ÿ')) pywebview.api.run_update(v); }

        // === [æ ¸å¿ƒé€»è¾‘é‡å†™] ç»¼åˆç‰ˆæœ¬ä¿¡æ¯å¼¹çª— ===
        let pendingUpdaterInfo = null;

        function showCombinedVersionModal(payload) {
            const { updates, updater_info, local_ver, launcher_ver } = payload;
            pendingUpdates = updates || [];
            pendingUpdaterInfo = updater_info || null;

            // ç‰ˆæœ¬å·æ˜¾ç¤º
            document.getElementById('modal-local-ver').innerText = local_ver || localVersion;
            document.getElementById('modal-launcher-ver').innerText = launcher_ver || '';

            // éšè—æ—§çš„ fetch-warn åŒºåŸŸï¼ˆå·²ç”±ç‹¬ç«‹å¼¹çª—æ›¿ä»£ï¼‰
            document.getElementById('fetch-warn-area').style.display = 'none';

            // æ›´æ–°å™¨æ–°ç‰ˆæœ¬æç¤º
            const updaterArea = document.getElementById('updater-info-area');
            if (updater_info) {
                document.getElementById('updater-info-text').innerText =
                    `æ–°ç‰ˆæœ¬ï¼š${updater_info.remote_ver}\næ›´æ–°å†…å®¹ï¼š${updater_info.desc}`;
                updaterArea.style.display = 'block';
            } else {
                updaterArea.style.display = 'none';
            }

            // å®¢æˆ·ç«¯æ›´æ–°åˆ—è¡¨
            const container = document.getElementById('update-list-content');
            container.innerHTML = '';
            const subtitle = document.getElementById('update-subtitle');

            if (pendingUpdates.length === 0) {
                subtitle.innerText = 'å½“å‰å®¢æˆ·ç«¯å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚';
                container.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.5; font-size:13px;">æ— å¾…æ›´æ–°å†…å®¹</div>';
                document.getElementById('btn-area').innerHTML =
                    '<button class="btn outline" onclick="closeUpdateModal()">å…³é—­</button>';
            } else {
                subtitle.innerText = `æ£€æµ‹åˆ° ${pendingUpdates.length} ä¸ªæœªå®‰è£…ç‰ˆæœ¬ï¼Œè¯·é€‰æ‹©éœ€è¦æ›´æ–°çš„å†…å®¹ï¼š`;
                pendingUpdates.forEach((item, index) => {
                    const isOptional = item.opt_update === true;
                    const div = document.createElement('div');
                    div.className = `update-item ${isOptional ? 'optional' : 'mandatory'}`;
                    let checkHtml = isOptional
                        ? `<input type="checkbox" class="update-checkbox" data-index="${index}" checked>`
                        : `<div style="width:18px; text-align:center; color:#ef4444; font-weight:bold;">!</div>`;
                    div.innerHTML = `
                        ${checkHtml}
                        <div class="update-content">
                            <div class="update-header">
                                <span>${item.version} <small style="font-weight:normal; opacity:0.6">${item.date || ''}</small></span>
                                <span class="update-badge ${isOptional ? 'badge-opt' : 'badge-req'}">${isOptional ? 'å¯é€‰' : 'å¿…é€‰'}</span>
                            </div>
                            <div class="update-body">${item.desc}</div>
                        </div>`;
                    container.appendChild(div);
                });
                // æ¢å¤é»˜è®¤æŒ‰é’®
                document.getElementById('btn-area').innerHTML =
                    `<button class="btn" onclick="triggerDownload('cn')">ğŸš€ CN åŠ é€Ÿæ›´æ–°</button>
                     <button class="btn outline" onclick="triggerDownload('global')">ğŸŒ å…¨çƒèŠ‚ç‚¹</button>
                     <button class="btn danger-outline" onclick="closeUpdateModal()">æš‚ä¸æ›´æ–°</button>`;
            }

            resetUpdateModalState();
            document.getElementById('update-modal').style.display = 'flex';
        }

        // å…¼å®¹æ—§è°ƒç”¨ï¼ˆä¿ç•™ï¼‰
        function showUpdateListModal(updates) {
            showCombinedVersionModal({ updates: updates, updater_info: null, fetch_warn: '', local_ver: localVersion, launcher_ver: '' });
        }

        function doUpdaterSelfUpdate() {
            if (!pendingUpdaterInfo) return;
            if (confirm(`ç¡®å®šè¦æ›´æ–°æ›´æ–°å™¨åˆ° ${pendingUpdaterInfo.remote_ver} å—ï¼Ÿ\n\næ›´æ–°å†…å®¹ï¼š${pendingUpdaterInfo.desc}\n\nç‚¹å‡»ç¡®å®šå°†è‡ªåŠ¨ä¸‹è½½å¹¶é‡å¯ã€‚`)) {
                pywebview.api.perform_self_update(pendingUpdaterInfo.url, pendingUpdaterInfo.remote_ver);
            }
        }

        function dismissUpdaterInfo() {
            document.getElementById('updater-info-area').style.display = 'none';
            pendingUpdaterInfo = null;
        }

        function closeUpdateModal() {
            document.getElementById('update-modal').style.display = 'none';
        }

        function resetUpdateModalState() {
            document.getElementById('progress-area').style.display = 'none';
            document.getElementById('btn-area').style.display = 'flex';
            document.getElementById('dl-bar').style.width = '0%';
            document.getElementById('dl-percent').innerText = '0%';
        }

        function triggerDownload(source) {
            if (!pendingUpdates || pendingUpdates.length === 0) return;

            // 1. æ”¶é›†ç”¨æˆ·é€‰ä¸­çš„æ›´æ–°
            const finalSelection = [];
            const checkboxes = document.querySelectorAll('.update-checkbox');

            // éå†åŸå§‹é˜Ÿåˆ—ï¼ŒåŒ¹é…å¤é€‰æ¡†çŠ¶æ€
            pendingUpdates.forEach((item, index) => {
                const isOptional = item.opt_update === true;
                let isSelected = true;

                if (isOptional) {
                    // æŸ¥æ‰¾å¯¹åº”çš„å¤é€‰æ¡†
                    const chk = document.querySelector(`.update-checkbox[data-index="${index}"]`);
                    if (chk && !chk.checked) {
                        isSelected = false;
                        // 2. æ²¡é€‰ä¸­çš„ï¼Œè°ƒç”¨åç«¯è®°å½•ä¸º skipped
                        pywebview.api.add_skipped_version(item.version);
                    }
                }

                if (isSelected) {
                    finalSelection.push(item);
                }
            });

            if (finalSelection.length === 0) {
                alert("æœªé€‰æ‹©ä»»ä½•æ›´æ–°ï¼");
                closeUpdateModal();
                return;
            }

            // åˆ‡æ¢ UI åˆ°ä¸‹è½½çŠ¶æ€
            document.getElementById('btn-area').style.display = 'none';
            document.getElementById('progress-area').style.display = 'block';

            // å‘é€æ‰¹é‡æ›´æ–°è¯·æ±‚
            pywebview.api.start_update_sequence(JSON.stringify(finalSelection), source);
        }

        function updateDownloadProgress(percent) {
            document.getElementById('dl-bar').style.width = percent + '%';
            document.getElementById('dl-percent').innerText = percent + '%';
        }

        // === [æ–°å¢] æ›´æ–°è¯¦ç»†è¿›åº¦ä¿¡æ¯ (é€Ÿåº¦ + çŠ¶æ€ + ç™¾åˆ†æ¯”) ===
        function updateProgressDetails(percent, speed, status) {
            document.getElementById('dl-bar').style.width = percent + '%';
            document.getElementById('dl-percent').innerText = percent + '%';
            if (speed) document.getElementById('dl-speed-text').innerText = speed;
            if (status) document.getElementById('dl-status-text').innerText = status;
            // åŒæ­¥å¼ºåˆ¶æ›´æ–°å¼¹çª—è¿›åº¦ï¼ˆå¦‚æœæ‰“å¼€ç€ï¼‰
            const forceBar = document.getElementById('force-dl-bar');
            if (forceBar) {
                forceBar.style.width = percent + '%';
                document.getElementById('force-dl-percent').innerText = percent + '%';
                if (speed) document.getElementById('force-dl-speed').innerText = speed;
                if (status) document.getElementById('force-dl-status').innerText = status;
            }
        }

        // === å¼ºåˆ¶æ‹‰å–å†å²ç‰ˆæœ¬å¼¹çª—é€»è¾‘ ===
        let allHistoryVersions = [];
        let selectedForceVersion = null;

        function showForceUpdateModal(history) {
            allHistoryVersions = history;
            selectedForceVersion = null;
            const list = document.getElementById('force-update-list');
            list.innerHTML = '';

            history.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'update-item mandatory';
                div.style.cursor = 'pointer';
                div.dataset.index = index;
                div.innerHTML = `
                    <input type="radio" name="force-ver-radio" value="${index}" style="margin-right:4px; cursor:pointer;">
                    <div class="update-content">
                        <div class="update-header">
                            <span>${item.version} <small style="font-weight:normal; opacity:0.6">${item.date || ''}</small></span>
                            <span class="update-badge badge-req">å†å²ç‰ˆæœ¬</span>
                        </div>
                        <div class="update-body">${item.desc || 'æ— æè¿°'}</div>
                    </div>`;
                div.addEventListener('click', () => {
                    const radio = div.querySelector('input[type=radio]');
                    radio.checked = true;
                    selectedForceVersion = item;
                    list.querySelectorAll('.update-item').forEach(el => el.style.background = '');
                    div.style.background = 'rgba(239,68,68,0.08)';
                });
                list.appendChild(div);
            });

            document.getElementById('force-progress-area').style.display = 'none';
            document.getElementById('force-btn-area').style.display = 'flex';
            document.getElementById('force-update-modal').style.display = 'flex';
        }

        function closeForceUpdateModal() {
            document.getElementById('force-update-modal').style.display = 'none';
            selectedForceVersion = null;
        }

        function triggerForceDownload(source) {
            if (!selectedForceVersion) {
                alert('è¯·å…ˆä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªè¦å¼ºåˆ¶é‡æ–°åº”ç”¨çš„ç‰ˆæœ¬ï¼');
                return;
            }
            const ver = selectedForceVersion.version;
            if (!confirm(`ç¡®å®šè¦å¼ºåˆ¶é‡æ–°åº”ç”¨ç‰ˆæœ¬ ${ver} çš„æ›´æ–°è§„åˆ™å—ï¼Ÿ\n\næ­¤æ“ä½œä¼šå¿½ç•¥å½“å‰ç‰ˆæœ¬å·ï¼Œç›´æ¥æ‰§è¡Œè¯¥ç‰ˆæœ¬çš„æ›´æ–°å†…å®¹ã€‚`)) return;

            document.getElementById('force-btn-area').style.display = 'none';
            document.getElementById('force-progress-area').style.display = 'block';

            pywebview.api.start_update_sequence(JSON.stringify([selectedForceVersion]), source);
        }

        // === [æ–°å¢] å¯åŠ¨æ—¶çš„ç›®å½•ä½ç½®å¼ºæ ¡éªŒ ===
        function verifyInstallationPath() {
            // è°ƒç”¨æˆ‘ä»¬åˆšæ‰åœ¨ Python é‡Œå†™çš„æ¥å£
            pywebview.api.check_game_directory_exists().then(isValid => {
                if (isValid) {
                    // âœ… æƒ…å†µAï¼šç›®å½•æ ¡éªŒé€šè¿‡
                    // é€šçŸ¥ Python å‰ç«¯å·²å°±ç»ªï¼ŒPython éšåä¼šè°ƒç”¨ initApp åŠ è½½æ•°æ®
                    pywebview.api.mark_ready();
                } else {
                    // âŒ æƒ…å†µBï¼šç›®å½•æ ¡éªŒå¤±è´¥ï¼Œå¼¹çª—é˜»æ–­
                    var userChoice = confirm(
                        "âš ï¸ ç›®å½•ç»“æ„æ ¡éªŒå¤±è´¥ï¼\n\n" +
                        "ç¨‹åºæœªæ£€æµ‹åˆ°ä»¥ä¸‹è·¯å¾„ï¼š\n" +
                        "â›” .minecraft\\versions\\å¼‚ç•Œæˆ˜æ–—å¹»æƒ³\n\n" +
                        "è¯·æ£€æŸ¥ï¼š\n" +
                        "1. æœ¬æ›´æ–°å™¨æ˜¯å¦æ”¾åœ¨äº†å’Œ [.minecraft] æ–‡ä»¶å¤¹åŒçº§çš„ç›®å½•ï¼Ÿ\n" +
                        "   (å³å’Œ HMCL.exe åœ¨ä¸€èµ·)\n" +
                        "2. æ‚¨çš„æ•´åˆåŒ…æ˜¯å¦å®Œæ•´ï¼Ÿ\n\n" +
                        "â€¢ ç‚¹å‡»ã€ç¡®å®šã€‘å¼ºåˆ¶å¯åŠ¨ï¼ˆåŠŸèƒ½å¯èƒ½å¼‚å¸¸ï¼‰ã€‚\n" +
                        "â€¢ ç‚¹å‡»ã€å–æ¶ˆã€‘é€€å‡ºç¨‹åºã€‚"
                    );

                    if (userChoice) {
                        // ç”¨æˆ·ç‚¹å‡»ç¡®å®š -> å¼ºåˆ¶é€šçŸ¥ Python å°±ç»ª
                        pywebview.api.mark_ready();
                    } else {
                        // ç”¨æˆ·ç‚¹å‡»å–æ¶ˆ -> ç›´æ¥å…³é—­çª—å£
                        pywebview.api.close_window();
                    }
                }
            });
        }

         // === åŠ¨æ€ç²’å­èƒŒæ™¯ç³»ç»Ÿ ===
        (function initParticles() {
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            let width, height;
            let particles = [];

            // ä» CSS å˜é‡è·å–ä¸»é¢˜è‰²ï¼Œè®©ç²’å­é¢œè‰²è·Ÿéšä¸»é¢˜å˜åŒ–
            function getAccentColor() {
                const style = getComputedStyle(document.documentElement);
                const color = style.getPropertyValue('--accent-color').trim();
                return color || '#f59e0b';
            }

            // ç²’å­ç±»
            class Particle {
                constructor() {
                    this.reset();
                }

                reset() {
                    this.x = Math.random() * width;
                    this.y = Math.random() * height;
                    // éšæœºå¤§å°ï¼šæ¨¡æ‹Ÿè¿œè¿‘æ„Ÿ
                    this.size = Math.random() * 2 + 0.5;
                    // ææ…¢çš„é€Ÿåº¦ï¼Œè¥é€ æ¼‚æµ®æ„Ÿ
                    this.speedX = (Math.random() - 0.5) * 0.4;
                    this.speedY = (Math.random() - 0.5) * 0.4;
                    this.opacity = Math.random() * 0.5 + 0.1;
                    this.life = Math.random() * 100; // é—ªçƒå‘¨æœŸ
                }

                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.life += 1;

                    // è¾¹ç•Œæ£€æŸ¥ï¼šè¶…å‡ºå±å¹•åä»å¯¹é¢é£å›
                    if (this.x > width) this.x = 0;
                    if (this.x < 0) this.x = width;
                    if (this.y > height) this.y = 0;
                    if (this.y < 0) this.y = height;

                    // å‘¼å¸é—ªçƒæ•ˆæœ
                    this.currentOpacity = this.opacity + Math.sin(this.life * 0.05) * 0.1;
                }

                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = getAccentColor(); // å®æ—¶è·å–ä¸»é¢˜è‰²
                    ctx.globalAlpha = Math.max(0, this.currentOpacity);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
            }

            function resize() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            }

            function init() {
                resize();
                // åˆ›å»º 60 ä¸ªç²’å­
                for (let i = 0; i < 60; i++) {
                    particles.push(new Particle());
                }
                animate();
            }

            function animate() {
                ctx.clearRect(0, 0, width, height);
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', resize);

            // å»¶è¿Ÿå¯åŠ¨ï¼Œç¡®ä¿ CSS å˜é‡å·²åŠ è½½
            setTimeout(init, 500);
        })();

    //  ç»“å°¾çš„äº‹ä»¶ç›‘å¬ä»£ç 
        window.addEventListener('new_log', e => addLog(e.detail));

        // ä¿®æ”¹ä¸ºï¼šå‡†å¤‡å¥½åï¼Œå…ˆå»æ‰§è¡Œ verifyInstallationPath æ£€æŸ¥ï¼Œé€šè¿‡äº†å† mark_ready
        window.addEventListener('pywebviewready', verifyInstallationPath);
    </script>
</body>

</html>